# **MedGemma 赋能：多Agent协同的精准营养与慢病风险评估系统**

## **一、 项目概述**

### **1.1 项目名称**

**NutriGuardian: 端侧驱动的精准营养评估与慢病风险预警平台**

### **1.2 核心思路与价值主张**

人工智能为医疗领域带来了变革，但在基层医疗、居家健康管理等场景，用户对**数据隐私、离线可用性、实时反馈**的需求极为迫切。本项目不追求替代专业诊断，而是聚焦于利用 **HAI-DEF模型中先进的生物医学预训练知识**，构建一个**以人为中心**的AI应用，填补从“健康数据采集”到“个性化风险洞察”之间的空白。

我们设计了一个多智能体协同系统，将复杂的健康评估任务拆解，由不同专长的AI Agent在**保护隐私**的前提下协作完成。系统核心使用 **MedGemma** 作为“医学知识大脑”，并协同其他HAI-DEF模型，共同处理用户提供的多模态健康数据（如文字描述的症状、可穿戴设备数据、膳食图片等），输出**易于理解的个性化营养评估与慢性病（如糖尿病、心血管疾病）风险简报**。

### **1.3 创新点**

- **端侧优先，隐私至上**：核心推理与敏感数据处理尽可能在用户设备端完成，利用**MedGemma 2B**等轻量化版本，实现离线或有限网络下的可靠服务。

- **HAI-DEF模型协同**：超越单一模型应用，构建一个Agent工作流，让HAI-DEF家族模型各司其职（如MedGemma负责医学推理，其他模型处理结构化数据或特定任务），发挥“1+1>2”的效用。

- **多模态健康数据融合**：不仅处理文本，还能初步解读用户上传的膳食图片（结合HAI-DEF的图像理解潜力），并结合可穿戴设备的时序数据，形成更全面的健康画像。

- **普惠性与可行性**：针对健康意识觉醒的广大人群和基层卫生工作者，提供一个低成本、易接入的AI辅助工具，提升健康管理的可及性。

---

## **二、 详细开发需求文档**

### **2.1 功能需求**

1. **用户健康档案创建与管理**：支持用户输入基本信息（年龄、性别、身高、体重）、生活习惯（运动、吸烟、饮酒）、既往病史、家族史。

2. **多模态数据输入**：

- **文本**：自由描述近期症状、不适感受、饮食内容。

- **图像**：上传一日三餐的食物图片。

- **数据**：通过接口同步或手动录入简易可穿戴设备数据（如近一周静息心率、步数）。

3. **智能分析与报告生成**：

- **综合分析**：融合所有输入数据，生成一份中文报告。

- **营养评估**：指出当前饮食模式中可能存在的营养过剩（如盐、糖、饱和脂肪）或缺乏（如膳食纤维、特定维生素）。

- **慢病风险简报**：基于输入信息，评估用户在未来数年内罹患2型糖尿病、高血压等常见慢病的相对风险等级（低、中、高），并列出主要风险因素。

- **个性化建议**：提供3-5条基于HAI-DEF知识的、贴近生活且安全的初步行动建议（如“尝试增加绿叶蔬菜摄入，替换部分精米白面为全谷物”）。

4. **交互与解释性**：

- 报告结论附带简短、通俗的解释，说明AI判断的依据（例如，“系统判断饱和脂肪摄入可能偏高，主要是基于您描述的频繁食用红烧肉的饮食习惯及上传的午餐图片识别出的大块肥肉”）。

- 提供简单的Q&A入口，用户可就报告内容进行追问。

### **2.2 非功能需求**

1. **性能**：核心分析流程（从提交到生成报告）在普通智能手机上端侧运行时间目标为10-15秒内。

2. **隐私与安全**：所有原始用户数据默认存储在本地。如需云端同步（如多设备），必须经用户明确授权，且数据需匿名化或加密。

3. **可用性**：界面简洁，流程引导清晰，报告语言通俗易懂，避免专业术语堆砌。

4. **可扩展性**：系统架构支持未来集成新的HAI-DEF模型或数据源（如连接更专业的医疗设备）。

### **2.3 技术栈与部署**

- **前端**：React Native / Flutter (兼顾iOS/Android) 或 渐进式Web应用。

- **后端（轻量）**：Python (FastAPI)，主要负责任务编排、非HAI-DEF的辅助计算、以及与端侧模型的协同（若采用部分云端推理的混合架构）。

- **核心AI模型**：

- **MedGemma (2B/7B参数版本)**：作为核心医学推理与知识生成引擎。

- **其他HAI-DEF模型**：根据具体任务选择，例如用于从文本中结构化提取医学实体的模型，或用于初版图像理解的模型。

- **部署**：

- **首选（端侧）**：将MedGemma轻量化模型转换为适合移动端推理的格式（如通过TensorFlow Lite或相应推理框架），直接集成到应用中。

- **备选（混合）**：敏感数据（如原始症状描述）在端侧由小模型预处理或加密，核心推理调用部署在私有云/边缘服务器上的完整版MedGemma，结果返回端侧。此方案需详细说明隐私保护措施。

---

## **三、 多智能体协同方案**

我们将设计 **3个核心Agent** 和 **1个协调Agent** 来完成任务。

### **3.1 Agent架构图**

```
用户输入    │    ▼[协调 Agent (Orchestrator)]    │    ├───► [数据感知与预处理 Agent]    │       │    │       ├── 文本清洗与关键信息提取    │       ├── 图像食物成分初筛 (若启用)    │       └── 时序数据标准化    │    ├───► [医学知识推理 Agent] (核心: MedGemma)    │       │    │       └── 任务：执行“思考链(CoT)”推理    │           - 结合预处理后的多模态数据    │           - 调用其预训练的医学知识    │           - 生成初步的医学评估、风险因素列表    │    └───► [报告生成与沟通 Agent]            │            ├── 将医学推理结果转化为用户友好语言            ├── 整合成结构化报告（营养评估、风险简报、建议）            └── 准备对用户可能的追问进行解释    │    ▼最终报告输出给用户
```

Plain Text

### **3.2 各Agent详细分工与提示词设计**

#### **Agent 1: 数据感知与预处理 Agent**

- **分工**：负责接收原始多模态数据，进行清洗、标准化和初步特征提取，为后续Agent准备高质量的输入。它不进行深度医学判断。

- **提示词模板 (核心逻辑描述)**：

> “你是一个健康数据预处理助手。你的任务是对用户输入进行结构化。
> 
> 1. **对于文本输入**：提取关键实体，如[症状]（如‘头晕’、‘多饮’）、[生活习惯]（如‘每周运动3次’）、[饮食描述]（如‘常吃油炸食品’）。忽略无关的情感描述。
> 
> 2. **对于图像输入（如果可用）**：调用图像识别模块，主要识别图中食物的**大类**（如‘绿叶蔬菜’、‘红肉’、‘精制主食’、‘高糖水果’）和**粗略分量**（如‘少量’、‘中等’、‘大量’）。输出为结构化列表。
> 
> 3. **对于数值数据**：将步数、静息心率等数据，按照[日期: 数值]的格式整理，并计算过去7天的平均值。
> 
> 4. 将所有结构化后的数据，按类别汇总成一个清晰的JSON对象，传递给下一个Agent。”

#### **Agent 2: 医学知识推理 Agent (基于MedGemma)**

- **分工**：系统的“大脑”。接收预处理后的结构化数据，利用其深厚的生物医学预训练知识，进行综合推理，识别潜在的健康问题、营养偏颇和风险因素。

- **提示词模板 (CoT思路引导)**：

> “你是一名具备丰富医学知识的AI助手（MedGemma）。请基于以下用户信息，进行逐步推理： **用户信息**： {预处理Agent输出的JSON数据} 
> 
> **请按步骤思考**：
> 
> 1. **症状解读**：用户描述的症状 [症状列表] ，可能共同指向哪些生理系统或潜在的健康问题？（例如，多饮、多尿、疲劳可能提示糖代谢问题）。
> 
> 2. **生活习惯与风险评估**：结合用户的年龄 [年龄] 、BMI [BMI] 、运动习惯 [运动] 和家族史 [家族史] ，评估其在常见慢性病（如2型糖尿病、高血压）方面的**主要风险因素**有哪些？
> 
> 3. **营养分析**：基于用户的饮食描述 [饮食] 和图像识别出的食物大类 [图像识别结果] ，分析其当前饮食模式在以下方面可能存在的问题：(a) 宏量营养素（碳水、脂肪、蛋白质）平衡；(b) 微量营养素（如膳食纤维、钠、添加糖）摄入是否合理？
> 
> 4. **综合判断**：综合以上分析，给出一个简要的、专业的内部评估摘要。注意：不要下诊断结论，而是描述‘观察到的风险模式’和‘营养层面的可改进点’。” _输出要求：请将你的推理过程和最终的内部评估摘要清晰地组织输出。_

#### **Agent 3: 报告生成与沟通 Agent**

- **分工**：将MedGemma生成的“专业内部评估”翻译成通俗易懂、积极正向、具有行动指导性的用户报告。负责最终输出格式和交互。

- **提示词模板**：

> “你是一个健康沟通专家，擅长将专业的医学信息转化为普通人能理解、不引起恐慌、且能激发行动的建议。
> 
> **任务**：根据以下医学推理摘要，生成一份给用户的最终报告。 **医学推理摘要**： {MedGemma Agent输出的内部评估摘要} 
> 
> **报告结构**：
> 
> 1. **致用户**：一段友好的开场白，感谢用户分享信息。
> 
> 2. **您的健康快照**：用1-2句话概括整体情况（如“总体来看，您的生活方式比较积极，但在饮食结构上存在一些常见的优化空间”）。
> 
> 3. **营养评估亮点**：
> 
> - **做得好**：先指出1-2个积极的方面（如“您经常摄入蔬菜，这非常棒”）。
> 
> - **关注点**：指出1-2个最主要的营养相关可优化点（如“红肉和加工食品的摄入频率似乎较高，这可能意味着饱和脂肪和钠的摄入量需要留意”）。
> 
> 4. **慢病风险简报**：以“基于您提供的信息，我们注意到以下因素可能与长期健康相关”的方式，列出2-3个最主要的**可改变的风险因素**（如“久坐的工作模式”、“膳食纤维摄入可能不足”）。**强调这是风险评估，不是诊断**。
> 
> 5. **个性化建议**：提供3条具体、可行、安全的初步行动建议（例如：“建议1: 尝试每周有2天用鱼肉或豆制品替换红肉。”“建议2: 下午点心可以尝试一小把坚果替代饼干。”“建议3: 如果可行，每小时起身走动5分钟。”）。
> 
> **请注意**：
> 
> - 语言亲和、鼓舞人心。
> 
> - 避免绝对化词汇和恐吓性语言（如不说“你这样会得糖尿病”，可说“优化这些习惯有助于长远降低风险”）。
> 
> - 在末尾附上一句免责声明：‘本评估基于AI模型生成，仅供参考，不能替代专业医疗建议。如有健康疑虑，请咨询医生或注册营养师。’”

#### **协调 Agent (Orchestrator)**

- **分工**：控制任务流程，调用和传递数据给上述三个Agent。处理异常，管理会话状态。

- **逻辑（非提示词，而是程序逻辑）**：

1. 接收用户原始输入。

2. 调用 **数据感知与预处理 Agent**。

3. 将预处理结果传给 **医学知识推理 Agent**，触发其推理。

4. 将推理摘要传给 **报告生成与沟通 Agent**，生成最终报告。

5. 将最终报告呈现给用户，并监听用户可能的后续追问（追问时，可将问题连同上下文再次路由给 **医学知识推理Agent** 或 **报告生成Agent**）。

---

这个方案充分利用了HAI-DEF模型（尤其是MedGemma）的专业知识，通过多Agent分工实现了复杂任务的分解与协作，并始终将用户体验、隐私保护和结果的可行性置于核心。提交时，我们将围绕此方案提供完整的说明文档、可运行的演示代码（包含Agent间调用逻辑）以及展示系统工作流程的演示视频。