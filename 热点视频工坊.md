“热点视频工坊” 应用的完整开发文档，涵盖了应用概述、核心功能、界面设计、技术实现等各个维度。我会基于这份文档，帮你梳理出一个可落地的**核心功能代码实现框架**，聚焦于前端核心逻辑和后端 API 设计，让你能快速搭建起应用的基础骨架。

---

## 一、核心功能实现思路

我会基于文档中提到的技术栈（React Native + Redux + Node.js/Express + MongoDB + FFmpeg），实现以下核心模块：

1. 前端：参数设置界面（核心交互入口）、状态管理（额度 / 金币 / 用户配置）
2. 后端：热点推荐 API、视频生成任务 API、用户额度管理 API
3. 核心逻辑：分镜脚本生成、视频合成调用

## 二、前端实现（React Native）

### 2.1 项目基础配置（关键依赖安装）

bash

运行

```
# 初始化React Native项目
npx react-native init HotVideoWorkshop
cd HotVideoWorkshop

# 安装核心依赖
npm install redux react-redux @reduxjs/toolkit axios react-navigation/native @react-navigation/stack react-native-safe-area-context react-native-screens
# 安装UI组件（可选，用于快速实现界面）
npm install react-native-paper react-native-slider
```

### 2.2 状态管理（Redux）- 存储用户额度、配置等核心状态

javascript

运行

```
// src/store/slices/appSlice.js
import { createSlice } from '@reduxjs/toolkit';

const initialState = {
  // 用户创作额度
  freeQuota: 3,
  // 金币数量
  goldCoins: 0,
  // 额外兑换的额度
  extraQuota: 0,
  // 当前选中的热点
  selectedHotTopic: null,
  // 参数设置
  videoParams: {
    shareLink: '',
    hotKeywords: '', // 最多15字符
    imageDesc: '',
    shotCount: 3, // 3-5个分镜
    videoStyle: 'hotNews', // 热点资讯/剧情创意/知识科普
    movieStyle: 'none', // 悬疑惊悚/轻松喜剧/浪漫爱情
    scriptElement: 'emotionalResonance' // 情感共鸣/悬念反转/生活化表达
  }
};

export const appSlice = createSlice({
  name: 'app',
  initialState,
  reducers: {
    // 减少创作额度
    useQuota: (state) => {
      if (state.freeQuota > 0) {
        state.freeQuota -= 1;
      } else if (state.extraQuota > 0) {
        state.extraQuota -= 1;
      }
    },
    // 金币兑换额度（假设10金币兑换1次）
    exchangeQuota: (state, action) => {
      const exchangeCount = action.payload;
      if (state.goldCoins >= exchangeCount * 10) {
        state.goldCoins -= exchangeCount * 10;
        state.extraQuota += exchangeCount;
      }
    },
    // 更新视频参数
    updateVideoParams: (state, action) => {
      state.videoParams = { ...state.videoParams, ...action.payload };
    },
    // 选择热点话题
    selectHotTopic: (state, action) => {
      state.selectedHotTopic = action.payload;
    }
  }
});

export const { useQuota, exchangeQuota, updateVideoParams, selectHotTopic } = appSlice.actions;
export default appSlice.reducer;
```

javascript

运行

```
// src/store/store.js
import { configureStore } from '@reduxjs/toolkit';
import appReducer from './slices/appSlice';

export const store = configureStore({
  reducer: {
    app: appReducer
  }
});
```

### 2.3 参数设置界面（核心交互页面）

javascript

运行

```
// src/screens/ParamsSettingScreen.js
import React, { useState } from 'react';
import { View, Text, TextInput, Button, Picker, StyleSheet, ScrollView } from 'react-native';
import { useDispatch, useSelector } from 'react-redux';
import { updateVideoParams } from '../store/slices/appSlice';

const ParamsSettingScreen = () => {
  const dispatch = useDispatch();
  const { videoParams } = useSelector((state) => state.app);
  const [localParams, setLocalParams] = useState(videoParams);

  // 保存参数
  const saveParams = () => {
    // 验证关键词长度（最多15字符）
    if (localParams.hotKeywords.length > 15) {
      alert('热点关键词最多15个字符');
      return;
    }
    // 验证分镜数量（3-5）
    if (localParams.shotCount < 3 || localParams.shotCount > 5) {
      alert('分镜数量需在3-5之间');
      return;
    }
    dispatch(updateVideoParams(localParams));
    alert('参数设置成功');
  };

  return (
    <ScrollView style={styles.container}>
      {/* 1. 分享链接解析 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>分享链接解析</Text>
        <TextInput
          style={styles.input}
          value={localParams.shareLink}
          onChangeText={(text) => setLocalParams({ ...localParams, shareLink: text })}
          placeholder="输入抖音/快手/B站视频链接"
        />
      </View>

      {/* 2. 热点关键词 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>热点关键词（最多15字）</Text>
        <TextInput
          style={styles.input}
          value={localParams.hotKeywords}
          onChangeText={(text) => setLocalParams({ ...localParams, hotKeywords: text })}
          placeholder="输入热点关键词"
          maxLength={15}
        />
      </View>

      {/* 3. 参考图片描述 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>参考图片描述</Text>
        <TextInput
          style={styles.input}
          value={localParams.imageDesc}
          onChangeText={(text) => setLocalParams({ ...localParams, imageDesc: text })}
          placeholder="描述图片风格/人物/场景"
          multiline
        />
      </View>

      {/* 4. 分镜数量 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>分镜数量（3-5）</Text>
        <Picker
          selectedValue={localParams.shotCount}
          onValueChange={(value) => setLocalParams({ ...localParams, shotCount: value })}
          style={styles.picker}
        >
          <Picker.Item label="3个分镜" value={3} />
          <Picker.Item label="4个分镜" value={4} />
          <Picker.Item label="5个分镜" value={5} />
        </Picker>
      </View>

      {/* 5. 视频风格 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>视频风格</Text>
        <Picker
          selectedValue={localParams.videoStyle}
          onValueChange={(value) => setLocalParams({ ...localParams, videoStyle: value })}
          style={styles.picker}
        >
          <Picker.Item label="热点资讯" value="hotNews" />
          <Picker.Item label="剧情创意" value="storyCreative" />
          <Picker.Item label="知识科普" value="knowledge" />
        </Picker>
      </View>

      {/* 6. 电影风格 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>电影风格</Text>
        <Picker
          selectedValue={localParams.movieStyle}
          onValueChange={(value) => setLocalParams({ ...localParams, movieStyle: value })}
          style={styles.picker}
        >
          <Picker.Item label="不使用" value="none" />
          <Picker.Item label="悬疑惊悚" value="suspense" />
          <Picker.Item label="轻松喜剧" value="comedy" />
          <Picker.Item label="浪漫爱情" value="romance" />
        </Picker>
      </View>

      {/* 7. 脚本创作元素 */}
      <View style={styles.inputGroup}>
        <Text style={styles.label}>脚本创作元素</Text>
        <Picker
          selectedValue={localParams.scriptElement}
          onValueChange={(value) => setLocalParams({ ...localParams, scriptElement: value })}
          style={styles.picker}
        >
          <Picker.Item label="情感共鸣" value="emotionalResonance" />
          <Picker.Item label="悬念反转" value="suspenseReversal" />
          <Picker.Item label="生活化表达" value="dailyExpression" />
        </Picker>
      </View>

      <Button title="保存参数" onPress={saveParams} />
    </ScrollView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#fef7fb', // 浅粉渐变基底
  },
  inputGroup: {
    marginBottom: 20,
  },
  label: {
    fontSize: 16,
    marginBottom: 8,
    color: '#333',
  },
  input: {
    height: 40,
    borderColor: '#ddd',
    borderWidth: 1,
    borderRadius: 8,
    paddingHorizontal: 10,
    backgroundColor: '#fff',
  },
  picker: {
    height: 50,
    borderColor: '#ddd',
    borderWidth: 1,
    borderRadius: 8,
    backgroundColor: '#fff',
  },
});

export default ParamsSettingScreen;
```

### 2.4 主界面（核心功能入口）

javascript

运行

```
// src/screens/HomeScreen.js
import React from 'react';
import { View, Text, Button, StyleSheet, TouchableOpacity } from 'react-native';
import { useDispatch, useSelector } from 'react-redux';
import { useQuota, exchangeQuota } from '../store/slices/appSlice';
import { useNavigation } from '@react-navigation/native';

const HomeScreen = () => {
  const dispatch = useDispatch();
  const navigation = useNavigation();
  const { freeQuota, goldCoins, extraQuota } = useSelector((state) => state.app);

  // 生成视频（扣减额度）
  const generateVideo = () => {
    if (freeQuota + extraQuota <= 0) {
      alert('暂无创作额度，可兑换额外额度');
      return;
    }
    dispatch(useQuota());
    // 跳转到参数设置页，完成后调用后端生成接口
    navigation.navigate('ParamsSetting');
  };

  // 兑换额度（10金币=1次）
  const exchange = () => {
    if (goldCoins < 10) {
      alert('金币不足，无法兑换');
      return;
    }
    dispatch(exchangeQuota(1));
    alert('兑换成功，获得1次额外创作额度');
  };

  return (
    <View style={styles.container}>
      {/* 顶部状态区 */}
      <View style={styles.statusBar}>
        <Text style={styles.statusText}>09:30</Text>
        <View style={styles.statusIcons}>
          <Text style={styles.callIcon}>📞</Text>
          <Text style={styles.msgIcon}>💬</Text>
          <Text style={styles.signalIcon}>📶</Text>
          <Text style={styles.batteryIcon}>🔋90%</Text>
        </View>
      </View>

      {/* 应用标题区 */}
      <View style={styles.header}>
        <Text style={styles.title}>热点视频工坊</Text>
        <Text style={styles.subtitle}>一键生成高质量热点视频</Text>
      </View>

      {/* 额度信息区 */}
      <View style={styles.quotaArea}>
        <Text style={styles.quotaText}>今日免费额度：{freeQuota}次</Text>
        <Text style={styles.quotaText}>额外额度：{extraQuota}次</Text>
        <Text style={styles.quotaText}>金币：{goldCoins}个</Text>
        <TouchableOpacity style={styles.exchangeBtn} onPress={exchange}>
          <Text style={styles.exchangeText}>兑换额度（10金币/次）</Text>
        </TouchableOpacity>
      </View>

      {/* 核心功能按钮 */}
      <View style={styles.buttonsArea}>
        <Button title="生成热点视频" onPress={generateVideo} />
        <Button title="分镜脚本历史" onPress={() => navigation.navigate('ScriptHistory')} />
        <Button title="收藏模板" onPress={() => navigation.navigate('CollectedTemplates')} />
        <Button title="热点推荐" onPress={() => navigation.navigate('HotTopics')} />
      </View>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fef7fb', // 浅粉渐变基底
    padding: 20,
  },
  statusBar: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 20,
  },
  statusText: {
    color: '#fff',
    fontSize: 14,
  },
  statusIcons: {
    flexDirection: 'row',
    gap: 8,
  },
  callIcon: {
    color: 'red',
  },
  msgIcon: {
    color: 'blue',
  },
  signalIcon: {
    color: '#fff',
  },
  batteryIcon: {
    color: '#fff',
  },
  header: {
    marginBottom: 30,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#333',
    textAlign: 'center',
  },
  subtitle: {
    fontSize: 14,
    color: '#666',
    textAlign: 'center',
    marginTop: 8,
  },
  quotaArea: {
    backgroundColor: '#fff',
    padding: 15,
    borderRadius: 12,
    marginBottom: 30,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 8,
  },
  quotaText: {
    fontSize: 16,
    marginBottom: 8,
    color: '#333',
  },
  exchangeBtn: {
    backgroundColor: '#ff6b8b',
    padding: 10,
    borderRadius: 8,
    marginTop: 10,
  },
  exchangeText: {
    color: '#fff',
    textAlign: 'center',
    fontSize: 14,
  },
  buttonsArea: {
    gap: 15,
  },
});

export default HomeScreen;
```

## 三、后端实现（Node.js + Express + MongoDB）

### 3.1 项目初始化与依赖安装

bash

运行

```
# 初始化后端项目
mkdir hot-video-server && cd hot-video-server
npm init -y

# 安装核心依赖
npm install express mongoose axios ffmpeg-static cors dotenv
# 安装开发依赖
npm install nodemon --save-dev
```

### 3.2 数据库模型设计（MongoDB）

javascript

运行

```
// models/User.js
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  userId: { type: String, required: true, unique: true },
  freeQuota: { type: Number, default: 3 },
  extraQuota: { type: Number, default: 0 },
  goldCoins: { type: Number, default: 0 },
  // 分镜脚本历史
  scriptHistory: [{
    title: String,
    content: Object, // 脚本内容（分镜、台词等）
    createTime: { type: Date, default: Date.now },
    videoUrl: String // 生成的视频链接
  }],
  // 收藏的模板
  collectedTemplates: [{
    templateId: String,
    templateName: String,
    style: String,
    collectTime: { type: Date, default: Date.now }
  }]
});

module.exports = mongoose.model('User', userSchema);
```

javascript

运行

```
// models/HotTopic.js
const mongoose = require('mongoose');

const hotTopicSchema = new mongoose.Schema({
  title: { type: String, required: true },
  content: { type: String, required: true },
  hotDegree: { type: Number, default: 0 }, // 热度值
  source: { type: String }, // 来源：抖音/快手/微博等
  createTime: { type: Date, default: Date.now },
  category: { type: String } // 分类：新闻/娱乐/科技等
});

module.exports = mongoose.model('HotTopic', hotTopicSchema);
```

### 3.3 核心 API 接口实现

javascript

运行

```
// server.js
require('dotenv').config();
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const User = require('./models/User');
const HotTopic = require('./models/HotTopic');
const ffmpeg = require('ffmpeg-static');
const { exec } = require('child_process');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// 中间件
app.use(cors());
app.use(express.json());

// 连接MongoDB
mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/hotVideoWorkshop')
  .then(() => console.log('MongoDB连接成功'))
  .catch(err => console.error('MongoDB连接失败：', err));

// 1. 获取热点话题列表
app.get('/api/hot-topics', async (req, res) => {
  try {
    // 按热度排序
    const hotTopics = await HotTopic.find().sort({ hotDegree: -1 }).limit(10);
    res.status(200).json({ success: true, data: hotTopics });
  } catch (err) {
    res.status(500).json({ success: false, message: '获取热点失败', error: err.message });
  }
});

// 2. 获取热点详情
app.get('/api/hot-topics/:id', async (req, res) => {
  try {
    const hotTopic = await HotTopic.findById(req.params.id);
    if (!hotTopic) {
      return res.status(404).json({ success: false, message: '热点不存在' });
    }
    res.status(200).json({ success: true, data: hotTopic });
  } catch (err) {
    res.status(500).json({ success: false, message: '获取热点详情失败', error: err.message });
  }
});

// 3. 生成视频（核心接口）
app.post('/api/generate-video', async (req, res) => {
  try {
    const { userId, videoParams, hotTopicId } = req.body;
    
    // 1. 验证用户额度
    const user = await User.findOne({ userId });
    if (!user) {
      return res.status(404).json({ success: false, message: '用户不存在' });
    }
    if (user.freeQuota + user.extraQuota <= 0) {
      return res.status(400).json({ success: false, message: '创作额度不足' });
    }

    // 2. 获取热点内容
    const hotTopic = await HotTopic.findById(hotTopicId);
    if (!hotTopic) {
      return res.status(404).json({ success: false, message: '热点不存在' });
    }

    // 3. 生成分镜脚本（简化版，实际需结合NLP分析）
    const scriptContent = generateScript(hotTopic, videoParams);
    
    // 4. 调用FFmpeg生成视频（简化版，实际需结合模板/素材）
    const videoPath = await generateVideoWithFFmpeg(scriptContent, videoParams);

    // 5. 保存脚本历史，扣减额度
    user.scriptHistory.push({
      title: hotTopic.title,
      content: scriptContent,
      videoUrl: videoPath
    });
    if (user.freeQuota > 0) {
      user.freeQuota -= 1;
    } else {
      user.extraQuota -= 1;
    }
    await user.save();

    res.status(200).json({
      success: true,
      message: '视频生成成功',
      data: {
        script: scriptContent,
        videoUrl: videoPath,
        remainingQuota: user.freeQuota + user.extraQuota
      }
    });
  } catch (err) {
    res.status(500).json({ success: false, message: '生成视频失败', error: err.message });
  }
});

// 辅助函数：生成分镜脚本
function generateScript(hotTopic, videoParams) {
  const { shotCount, videoStyle, scriptElement } = videoParams;
  const shots = [];
  
  // 生成3-5个分镜
  for (let i = 0; i < shotCount; i++) {
    shots.push({
      shotId: i + 1,
      duration: 3 + Math.random() * 2, // 3-5秒
      content: `${hotTopic.title.substring(0, 20)} - 分镜${i+1}`,
      style: videoStyle,
      element: scriptElement
    });
  }

  return {
    title: hotTopic.title,
    description: hotTopic.content.substring(0, 100),
    shots: shots
  };
}

// 辅助函数：调用FFmpeg生成视频（简化版）
async function generateVideoWithFFmpeg(script, params) {
  return new Promise((resolve, reject) => {
    // 生成唯一视频文件名
    const videoName = `video_${Date.now()}.mp4`;
    const outputPath = path.join(__dirname, 'videos', videoName);
    
    // 模拟FFmpeg调用（实际需结合素材/模板）
    const ffmpegCommand = `${ffmpeg} -f lavfi -i color=c=white:s=720x1280:d=${script.shots.length * 5} -vf "drawtext=text='${script.title}':fontsize=30:x=(w-text_w)/2:y=(h-text_h)/2" -c:v libx264 -pix_fmt yuv420p ${outputPath}`;
    
    exec(ffmpegCommand, (err) => {
      if (err) reject(err);
      else resolve(`/videos/${videoName}`);
    });
  });
}

// 启动服务器
app.listen(PORT, () => {
  console.log(`服务器运行在 http://localhost:${PORT}`);
});
```

## 四、关键补充说明

1. **FFmpeg 使用**：实际项目中需准备视频模板 / 素材库，通过 FFmpeg 拼接素材、添加文字 / 音效、调整色调等，上述代码仅为简化示例。
2. **热点采集**：可通过爬虫（如 Cheerio）采集微博 / 抖音热点，或调用第三方热点 API，定时更新到 MongoDB。
3. **NLP 分析**：需集成 NLP 库（如 Jieba 分词、情感分析库）提取热点关键词、情感倾向，辅助生成脚本。
4. **前端界面优化**：可结合 React Native Paper/UI Kitten 实现文档中提到的 “浅粉渐变背景、低饱和肌理感” 等视觉效果。
5. **权限与安全**：实际项目需添加用户认证（如 JWT）、参数校验、接口限流等安全措施。

---

### 总结

1. **核心技术栈**：前端基于 React Native + Redux 实现跨平台界面和状态管理，后端基于 Node.js + Express + MongoDB 实现 API 和数据存储，FFmpeg 负责视频合成。
2. **核心逻辑**：用户额度管理（免费 + 金币兑换）→ 热点选择 → 参数配置 → 脚本生成 → 视频合成 → 历史记录保存。
3. **关键扩展点**：需补充热点采集爬虫、NLP 内容分析、视频素材库、用户认证等模块，才能实现完整的 “热点视频工坊” 应用。