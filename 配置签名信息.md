 HarmonyOS NEXT 地图SDK  开发指南  获取key

# 获取Key最后更新时间: 2024年07月12日

## 如何申请key

### 1、创建新应用

进入 [控制台](https://lbs.amap.com/dev/)，创建一个新应用。如果您之前已经创建过应用，可直接跳过这个步骤。

![](https://a.amap.com/lbs/static/img/doc/doc_1710840141913_9b267.png)

![](https://a.amap.com/lbs/static/img/doc/doc_1710840149435_8db7d.png)

### 2、添加新Key

在创建的应用上点击"添加新Key"按钮，在弹出的对话框中，依次：输入应用名名称，选择绑定的服务为“HarmonyOS平台”，输入AppID，如下图所示：

注意

 1个KEY只能用于一个应用（多渠道安装包属于多个应用），1个Key在多个应用上使用会出现服务调用失败。

![](https://a.amap.com/lbs/static/img/doc/doc_1710840101456_d2b5c.png)

在阅读完高德地图API服务条款后，勾选此选项，点击“提交”，完成 Key 的申请，此时您可以在所创建的应用下面看到刚申请的 Key 了。
如何获取AppID
请在当前应用的Ability中使用如下代码获取

let flag = bundleManager.BundleFlag.GET_BUNDLE_INFO_WITH_SIGNATURE_INFO;
let bundleInfo = bundleManager.getBundleInfoForSelfSync(flag)
let appId = bundleInfo.signatureInfo.appId;

注意事项
 1. 获取AppID之前需要先配置应用的签名信息，应用的签名信息配置请参考华为官网的配置应用签名信息指南

 2. 为了确保鉴权通过，请确保真机调试时使用的key是基于真机获取的appid申请的，而云真机调试时则应使用云真机appid对应的key，正确的appId形式为："包名_签名信息"， 例如：com.amap.demo_BGtGgVB3ASqU7ar1nHkwX4s0nIexDbEwqNrVoatUDs17GrClWC7V2/zhoYh6tFQHAd5DASWVTEAgvZfzrEGljjs=  使用远程真机运行应用/服务
更新时间: 2024-06-29 15:33
概述
说明
该特性在DevEco Studio V2.2 Beta1及更高版本中支持。

如果开发者没有真机设备资源，则不能很方便的调试和验证HarmonyOS应用，为方便开发者，DevEco Studio提供了Remote Device远程真机设备资源供开发者使用，减少开发成本。目前，远程真机支持Phone和Wearable设备，开发者使用远程真机调试和运行应用时，同本地物理真机设备一样，需要对应用/服务进行签名才能运行。

相比远程模拟器，远程真机是部署在云端的真机设备资源，远程真机的界面渲染和操作体验更加流畅，同时也可以更好的验证应用/服务在真机设备上的运行效果，比如性能、手机网络环境等。

前提条件
已注册成为华为开发者，并完成华为开发者实名认证。
已对应用/服务进行签名，具体签名指导请参考为应用/服务进行签名。
说明
需要注意的是，远程真机每次释放后重新申请，服务端分配的设备都不一样。因此，每次重新申请远程真机后，都需要对应用/服务重新进行签名。

操作步骤
在DevEco Studio菜单栏，单击Tools > Device Manager。
在Remote Device页签中，单击Sign In，在浏览器中弹出华为开发者联盟帐号登录界面，请输入已实名认证的华为开发者联盟帐号的用户名和密码进行登录（查看登录授权常见问题）。


登录后，请单击界面的允许按钮进行授权。


在Single device中，单击设备运行按钮，启动远程真机设备（同一时间只能启动一个设备）。


单击DevEco Studio的Run > Run'模块名称'或，或使用默认快捷键Shift+F10（macOS为Control+R）。


DevEco Studio会启动应用/服务的编译构建，完成后应用/服务即可运行在远程真机上。


使用模拟器运行应用/服务
# 为应用/服务进行签名

更新时间: 2024-06-29 15:33

针对应用/服务的签名，DevEco Studio为开发者提供了[自动签名](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section18815157237)方案，帮助开发者高效进行调试。也可选择[手动方式](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section297715173233)对应用/服务进行签名，如果使用了需要[ACL](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section157591551175916)的权限，需采用手动方式进行签名。

## 自动签名

说明

使用自动签名前，请确保本地系统时间与北京时间（UTC/GMT +8.00）保持一致。如果不一致，将导致签名失败。

1. 连接真机设备，确保[DevEco Studio与真机设备已连接](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/run_phone_tablat-0000001064774652-V2)，真机连接成功后如下图所示：
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.50477882195741200557373488333331:50001231000000:2800:0F89798BA768D203AF5517C43DE7399F262025C3DE77EA505067DC089A46E8AB.png?needInitFileName=true?needInitFileName=true)
    
    说明
    
    如果同时连接多个设备，则使用自动化签名时，会同时将这多个设备的信息写到证书文件中。
    
2. 进入**File > Project Structure > Project > Signing Configs**界面，勾选“Automatically generate signature”（如果是API 8和9工程，需同时勾选“SupportHarmonyOS”），即可完成签名。如果未登录，请先单击**Sign In**进行登录，然后自动完成签名。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.50156081952227115866238722513190:50001231000000:2800:27998361F195CD8549D15255A9E9C2FE21794DCEDEB2441338AB1F69E2E6CB19.png?needInitFileName=true?needInitFileName=true)
    
    签名完成后，如下图所示：
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.11386993356801227145977274760708:50001231000000:2800:A388DEE679FA2583DB5EFAAD5064EFE59175B16E14F7E322BF39A9DA5E45A906.png?needInitFileName=true?needInitFileName=true)
    

## 手动签名

HarmonyOS应用/服务通过数字证书（.cer文件）和Profile文件（.p7b文件）来保证应用/服务的完整性。在申请数字证书和Profile文件前，首先需要通过DevEco Studio或命令行工具来生成密钥（存储在格式为.p12的密钥库文件中）和证书请求文件（.csr文件）。然后，申请调试数字证书和调试Profile文件。最后，将密钥（.p12）文件、数字证书（.cer）文件和Profile（.p7b）文件配置到工程中。

**基本概念**

- **密钥**：格式为.p12，包含非对称加密中使用的公钥和私钥，存储在密钥库文件中，公钥和私钥对用于数字签名和验证。
- **证书请求文件**：格式为.csr，全称为Certificate Signing Request，包含密钥对中的公钥和公共名称、组织名称、组织单位等信息，用于向AppGallery Connect申请数字证书。
- **数字证书**：格式为.cer，由华为AppGallery Connect颁发。
- **Profile文件**：格式为.p7b，包含HarmonyOS应用/服务的包名、数字证书信息、描述应用/服务允许申请的证书权限列表，以及允许应用/服务调试的设备列表（如果应用/服务类型为Release类型，则设备列表为空）等内容，每个应用/服务包中均必须包含一个Profile文件。

### 生成密钥和证书请求文件

**使用DevEco Studio生成密钥和证书请求文件**

1. 在主菜单栏单击**Build > Generate Key** **and CSR**。
    
    说明
    
    如果本地已有对应的密钥，无需新生成密钥，可以在**Generate Key**界面中单击下方的Skip跳过密钥生成过程，直接使用已有密钥生成证书请求文件。
    
2. 在**Key Store File**中，可以单击**Choose Existing**选择已有的密钥库文件（存储有密钥的.p12文件）；如果没有密钥库文件，单击**New**进行创建。下面以新创建密钥库文件为例进行说明。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.70466805707095822962363298057911:50001231000000:2800:861ADC59DACB8C5954BCA624A8F02BB02629E42E74F010AFD8381CAAC1A52373.png?needInitFileName=true?needInitFileName=true "点击放大")
    
3. 在**Create Key Store**窗口中，填写密钥库信息后，单击**OK**。
    
    - **Key Store File**：设置密钥库文件存储路径，并填写p12文件名。
    - **Password**：设置密钥库密码，必须由大写字母、小写字母、数字和特殊符号中的两种以上字符的组合，长度至少为8位。请记住该密码，后续签名配置需要使用。
    - **Confirm Password**：再次输入密钥库密码。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.60246509516314649690595766304828:50001231000000:2800:A1B467DF85EE66E048CDC9966182D8620DC3AB54780E59765CC175B72CAD6E2B.png?needInitFileName=true?needInitFileName=true)
    
4. 在**Generate Key** **and CSR**界面中，继续填写密钥信息后，单击**Next**。
    
    - **Alias**：密钥的别名信息，用于标识密钥名称。请记住该别名，后续签名配置需要使用。
    - **Password**：密钥对应的密码，与密钥库密码保持一致，无需手动输入。
    - **Validity**：证书有效期，建议设置为25年及以上，覆盖应用/服务的完整生命周期。
    - **Certificate**：输入证书基本信息，如组织、城市或地区、国家码等。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122053.02331423797292712485275517124396:50001231000000:2800:BC4802351659D8BFB3D3D40DA3E5A005E6BAC770D3394DDE6952FB0FF5BD96F0.png?needInitFileName=true?needInitFileName=true "点击放大")
    
5. 在**Generate Key** **and CSR**界面，设置CSR文件存储路径和CSR文件名。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.35063725452729867794466585398180:50001231000000:2800:ECF934552C715D384575D3A9090E549586CA7803FAF59FC4753B164467B0442F.png?needInitFileName=true?needInitFileName=true "点击放大")
    
6. 单击**OK**，创建CSR文件成功，可以在存储路径下获取生成的密钥库文件（.p12）和证书请求文件（.csr）。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.58715805814288984929884740002922:50001231000000:2800:E8208E2E2E9432BAC7DE4E0035680E8C544B0CAC4FE15433AA4AAA47B3C71016.png?needInitFileName=true?needInitFileName=true)
    

**使用命令行工具生成证书请求文件**

使用Open JDK携带的Keytool工具生成证书请求文件。

1. 使用管理员身份运行命令行工具。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.39242153372040180603935381346116:50001231000000:2800:172E34521C8EBC0FDFBD2799A07E8A1921EF13EA6D92EF3714070D97C5ADA3F1.png?needInitFileName=true?needInitFileName=true)
    
2. 切换到keytool工具所在路径，路径为DevEco Studio安装目录下的jbr\bin目录。
3. 执行如下命令，生成公私钥文件。例如，生成的密钥库名称为idedemokey.p12，存储到D盘根目录下。
    
    1. keytool -genkeypair -alias "ide_demo_app" -keyalg EC -sigalg SHA256withECDSA -dname "C=CN,O=HUAWEI,OU=HUAWEI IDE,CN=ide_demo_app"  -keystore d:\\idedemokey.p12 -storetype pkcs12 -validity 9125 -storepass 123456Abc -keypass 123456Abc
    
    生成公私钥文件的参数说明如下：
    
    说明
    
    请记录**下alias、storepass**和**keypass**的值，在后续[手动配置签名信息](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/ide_debug_device-0000001053822404#section112371245115818)操作会使用到。
    
    - **alias**：密钥的别名信息，用于标识密钥名称。
    - **sigalg**：签名算法，固定为**SHA256withECDSA**。
    - **dname**：按照操作界面提示进行输入。
        - C：国家/地区代码，如CN。
        - O：组织名称，如HUAWEI。
        - OU：组织单位名称，如HUAWEI IDE。
        - CN：名字与姓氏，建议与别名一致。
    - **validity**：证书有效期，建议设置为9125（25年）。
    - **storepass**：设置密钥库密码，必须由大写字母、小写字母、数字和特殊符号中的两种以上字符的组合，长度至少为8位。请记住该密码，后续签名配置需要使用。
    - **keypass**：设置密钥的密码，请与**storepass**保持一致。
    
4. 执行如下命令，执行后需要输入**storepass**密码，生成证书请求文件，后缀格式为.csr。
    
    1. keytool -certreq -alias "ide_demo_app" -keystore d:\\idedemokey.p12 -storetype pkcs12 -file d:\\idedemokey.csr
    
    生成证书请求文件的参数说明如下：
    
    - **alias**：与上一步骤中输入的alias保持一致。
    - **file**：生成的证书请求文件名称，后缀为.csr。
    

### 申请调试证书和调试Profile文件

通过生成的证书请求文件，向AppGallery Connect申请调试证书和Profile文件，操作如下：

- 创建HarmonyOS应用/服务：在AppGallery Connect项目中，创建一个HarmonyOS应用/服务，用于调试证书和Profile文件申请，具体请参考[创建HarmonyOS应用](https://developer.huawei.com/consumer/cn/doc/distribution/app/agc-help-harmonyos-introduction-0000001172299745#section1098493513117)。
- 申请调试证书和Profile文件：在AppGallery Connect中申请、下载调试证书和Profile文件，具体请参考[申请调试证书和Profile文件](https://developer.huawei.com/consumer/cn/doc/distribution/app/agc-help-harmonyos-debugapp-manual-0000001177608893)。

### 手动配置签名信息

在DevEco Studio中配置密钥（.p12）文件、申请的调试证书（.cer）文件和调试Profile（.p7b）文件。

在**File >** **Project Structure >** **Project > Signing Configs**窗口中，去勾选“Automatically generate signature”（API 8和9工程请勾选“support HarmonyOS”），然后配置工程的签名信息。

- **Store File**：选择密钥库文件，文件后缀为.p12，该文件为[生成密钥和证书请求文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section462703710326)中生成的.p12文件。
- **Store Password**：输入密钥库密码，该密码与[生成密钥和证书请求文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section462703710326)中填写的密钥库密码保持一致。
- **Key Alias**：输入密钥的别名信息，与[生成密钥和证书请求文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section462703710326)中填写的别名保持一致。
- **Key Password**：输入密钥的密码，与[生成密钥和证书请求文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section462703710326)中填写的**Store Password**保持一致。
- **Sign Alg**：签名算法，固定为SHA256withECDSA。
- **Profile File**：选择[申请调试证书和调试Profile文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section15151840123413)中生成的Profile文件，文件后缀为.p7b。
- **Certpath File**：选择[申请调试证书和调试Profile文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section15151840123413)中生成的数字证书文件，文件后缀为.cer。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.12731644722529450194755342858884:50001231000000:2800:D24193CE3DB5FB3CA7589F46E1F5D33B8D4C430940C450644B7DB164AE36326C.png?needInitFileName=true?needInitFileName=true "点击放大")

### 使用ACL的签名配置指导

如果应用需要使用跨级别权限时，需使用ACL方式来申请对应权限。当前仅部分权限支持使用ACL方式申请，在[应用权限列表](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/permission-list-0000001544464017-V3)中标记“ACL使能：TRUE，可通过应用市场（AGC）申请”的为支持ACL的权限。

1. 申请进入ACL白名单。
    
    请提供[APP ID](https://developer.huawei.com/consumer/cn/doc/distribution/app/agc-help-appinfo-0000001100014694)发送到agconnect@huawei.com。收到邮件后，AGC运营审核通过后将进行白名单配置，审核周期一个工作日，请耐心等待。
    
2. 获取密钥和证书请求文件，请参见[生成密钥和证书请求文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#section462703710326)。
3. 申请调试证书，请参见[申请调试证书](https://developer.huawei.com/consumer/cn/doc/distribution/app/agc-help-harmonyos-debugapp-manual-0000001177608893#section13331154632718)。
4. 申请调试Profile。
    1. 登录[AppGallery Connect](https://developer.huawei.com/consumer/cn/service/josp/agc/index.html)，选择“我的项目”
    2. 找到您的项目，点击您创建的HarmonyOS应用/服务。
    3. 选择“HarmonyOS应用 > HAP Provision Profile管理”，进入“管理HAP Provision Profile”页面，点击右上角“添加”。![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.29413799238215313997375142521898:50001231000000:2800:8B39D8B1B890BC42C026936D048B0F699A9104C9C90E771BA944AA7CAD9EC4EC.png?needInitFileName=true?needInitFileName=true)
        
    4. 在弹出的“HarmonyAppProvision信息”窗口分别输入信息：
        
        - 名称：不超过100个字符。
        - 类型：选择“调试”。
            
            说明
            
            当前仅支持申请调试证书，类型请勿选择发布。
            
        - 选择证书：选择上一步得到用于调试的数字证书。
        - 选择设备：选择需要调试的设备，可选择一个或多个。
        - 申请受限权限：勾选需要申请使用的受限权限（需要先完成[申请进入ACL白名单](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/signing-0000001587684945-V2#ZH-CN_TOPIC_0000001622642277__li95073213217)，当开通ACL白名单后，才会出现配置项“申请受限ACL权限”）。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.52702827443308828590535057559785:50001231000000:2800:27A0ED12CBDD8D8DC8A7075978CEEFE91FE665288A66B240C26800F52B587D63.png?needInitFileName=true?needInitFileName=true)
        
    5. 调试Profile申请成功后 ，在“管理HAP Provision Profile”页面点击“下载”，获取Profile文件。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.79198506461177675087596924012233:50001231000000:2800:6C183F74D568A7460156DF45790EEBBEDEA11B3A5444E7A3937D2FFA5CA49086.png?needInitFileName=true?needInitFileName=true)
        
5. 在配置文件中添加权限信息。
    
    在需要使用权限的模块的module.json5文件中添加“requestPermissions”字段，并在字段下添加对应的权限名等信息，以权限“ohos.permission.ACCESS_IDS”为例。
    
    1. {
    2.   "module": {
    3.     ...
    4.     "requestPermissions": [{
    5.       "name": "ohos.permission.ACCESS_IDS",
    6.     }],
    7.     ...
    8.   }
    9. }
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.20817706163472292836845486884938:50001231000000:2800:F714E5F3BEE1DDAC393A40AEFF945A5004B1BCFBEC64594222F46AA63BB6A170.png?needInitFileName=true?needInitFileName=true)
    
6. 手动配置签名信息。
    1. 连接真机设备，确保[DevEco Studio与真机设备已连接](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/run_phone_tablat-0000001064774652-V2)。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.60192612111211114139374057783577:50001231000000:2800:5CA1A0E74B0A63DED62B5880E677B5C658F6684152722052C0C76635F5F05868.png?needInitFileName=true?needInitFileName=true)
        
    2. 点击DevEco Studio右上角的按钮![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.60643838422786108032352000868374:50001231000000:2800:8532D951268B9BB0FC47D69B529AE0FD248862D2020D739978FB6FAA5EB0E501.png?needInitFileName=true?needInitFileName=true)打开“Project Structure”窗口，进入“Signing Config”页签，取消勾选“Automatically generate signature”。
        
        在“Signing”下分别配置密钥(.p12文件)、Profile(.p7b文件)和数字证书(.cer文件)的路径等信息。
        
        勾选“Show restricted permissions”，即可看到配置成功的权限。
        
        配置完毕后，点击“Apply”。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.86755368130278025525161476977652:50001231000000:2800:EBEC84A95F5C9E9872C905C55BECB076F3DD94CB6D8D60FC014C5063BED94490.png?needInitFileName=true?needInitFileName=true)
        
7. 进入工程级build-profile.json5文件，在“signingConfigs”下可查看到配置成功的签名信息，点击右上角的“Run”按钮运行应用/服务。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20240629122054.96319838693952303370110692300620:50001231000000:2800:D473B9311BE4B594C70CCCE5A29D893B8C30C86654076BACDD9F8856F1BF39FA.png?needInitFileName=true?needInitFileName=true)
    