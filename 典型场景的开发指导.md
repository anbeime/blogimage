# 集成态HSP

更新时间: 2025-12-16 16:34

集成态HSP是应用内HSP的中间编译产物，用于解决使用方的bundleName和签名之间的强耦合问题。

说明

HSP只能给bundleName一样的工程使用，集成态HSP可以给不同的bundleName的工程集成使用。

使用方使用集成态HSP时，需要采用使用方的签名文件对集成态HSP重新签名，且需要优先安装重新签名后的集成态HSP。

## 使用场景

集团内部有多个应用，多个应用中都有一个相同的动态共享包。为了节约开发成本并实现代码和资源的共享，多个应用可以共用一个基建HSP（集成态HSP）。

## 约束限制

- 集成态HSP只支持[Stage模型](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-package-structure-stage)。
- 集成态HSP需要API12及以上版本，需要在工程级的[build-profile.json5文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile-app)中，将useNormalizedOHMUrl字段设置为true。

## 开发使用说明

1. 创建方-集成态HSP-工程配置：配置工程级的build-profile.json5文件，将useNormalizedOHMUrl字段设置为true。
    
    1. // created_party_project/build-profile.json5
    2. {
    3.   "app": {
    4.     "products": [
    5.       {
    6.         "name": "default",
    7.         "signingConfig": "default",
    8.         "compatibleSdkVersion": "5.0.0(12)",
    9.         "runtimeOS": "HarmonyOS",
    10.         "buildOption": {
    11.           "strictMode": {
    12.             "useNormalizedOHMUrl": true
    13.           }
    14.         }
    15.         // ...
    16.       }
    17.     ]
    18.     // ...
    19.   }
    20. }
    
2. 创建方-集成态HSP-模块配置：修改模块级构建配置文件[build-profile.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile)，将integratedHsp配置项设置为true，指定构建的HSP模块为集成态HSP。
    
    1. // created_party_project/library/build-profile.json5
    2. {
    3.   "apiType": "stageMode",
    4.   "buildOption": {
    5.     "arkOptions": {
    6.       "integratedHsp": true
    7.     }
    8.   }
    9. }
    
3. 创建方-集成态HSP-打包配置（tgz包）。
    
    (1) 配置项目签名信息，详情请参见[应用/元服务签名](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing)。
    
    (2) 配置release模式。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216163405.95974171999360451811916628913781:50001231000000:2800:EA7BA9A59C36081F7239EBEB1435219879E52F9402EA394043309CE145C01198.png)
    
    (3) 选择library目录，执行Build -> Make Module 'library'。
    
4. 使用方-创建目录并拷贝文件：在entry目录下新建libs目录，将集成态打包产物tgz包拷贝到libs目录下。
    
5. 使用方-工程依赖配置：在使用方主模块的oh-package.json5配置文件中添加依赖。
    
    1. // user_project/entry/oh-package.json5
    2.   "dependencies": {
    3.     "hsp": "./libs/library-default.tgz"
    4.   }
    
6. 使用方-工程配置：在工程级的build-profile.json5文件中，将useNormalizedOHMUrl字段设置为true。
    
    1. // user_project/build-profile.json5
    2. {
    3.   "app": {
    4.     "products": [
    5.       {
    6.         "name": "default",
    7.         "signingConfig": "default",
    8.         "compatibleSdkVersion": "5.0.0(12)",
    9.         "runtimeOS": "HarmonyOS",
    10.         "buildOption": {
    11.           "strictMode": {
    12.             "useNormalizedOHMUrl": true
    13.           }
    14.         }
    15.       }
    16.     ]
    17.   }
    18. }
    
    说明
    
    安装和运行应用前，必须配置项目签名信息，详见[应用/元服务签名](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing)。
    # HAR转HSP指导

更新时间: 2025-12-16 16:34

目前HAR的使用存在打包多份，包膨胀的问题，导致整体应用包的体积很大，HSP可以很好地解决该问题，本文介绍如何通过配置项的变更将HAR工程转换为HSP工程。

说明

部分组件和模块在HAP、HSP、HAR中集成使用时存在差异，例如[加载HAR中Worker线程文件相比HSP存在单独的使用约束](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)，因此按照如下步骤完成HAR转HSP后，请关注对应组件和模块介绍并进行适配。

## HAR转HSP的操作步骤

1. 修改HAR模块下的module.json5文件，将type字段设置为shared，并新增deliveryWithInstall和pages字段。
    
    1. // MyApplication\library\src\main\module.json5
    2. {
    3.   "module": {
    4.     "type": "shared",
    5.     "deliveryWithInstall": true,
    6.     "pages": "$profile:main_pages"
    7.     // ...
    8.   }
    9. }
    
2. 在resources\base下新增profile文件夹，在profile下新增一个main_pages.json文件，并配置如下内容。
    
    1. // MyApplication\library\src\main\resources\base\profile\main_pages.json
    2. {
    3.   "src": [
    4.     "pages/PageIndex"
    5.   ]
    6. }
    
3. 在ets目录下新增pages目录，并在pages目录下新增PageIndex.ets文件，配置如下内容。
    
    1. // MyApplication\library\src\main\ets\pages\PageIndex.ets
    2. @Entry
    3. @Component
    4. struct PageIndex {
    5.   @State message: string = 'hello world';
    
    6.   build() {
    7.     Row() {
    8.       Column() {
    9.         Text(this.message)
    10.           .fontSize(50)
    11.           .fontWeight(FontWeight.Bold)
    12.       }
    13.       .width('100%')
    14.     }
    15.     .height('100%')
    16.   }
    17. }
    
4. 删除HAR模块的build-profile.json5文件中的consumerFiles字段配置。
    
5. 修改HAR模块的hvigorfile.ts文件，将以下内容替换文件内容。
    
    1. // MyApplication\library\hvigorfile.ts
    2. import { hspTasks } from '@ohos/hvigor-ohos-plugin';
    
    3. export default {
    4.   system: hspTasks,  /* Built-in plugin of Hvigor. It cannot be modified. */
    5.   plugins:[]         /* Custom plugin to extend the functionality of Hvigor. */
    6. }
    
6. 修改oh-package.json5文件，新增packageType配置。
    
    1. // MyApplication\library\oh-package.json5
    2. {
    3.   "packageType": "InterfaceHar"
    4. }
    
7. 修改项目根目录下的build-profile.json5文件，在modules标签下找到library的配置，新增targets标签。
    
    1. // MyApplication\build-profile.json5
    2. "modules": [
    3.   {
    4.     "name": "library",
    5.     "srcPath": "./library",
    6.     "targets": [
    7.       {
    8.         "name": "default",
    9.         "applyToProducts": [
    10.           "default"
    11.         ]
    12.       }
    13.     ]
    14.   }
    15. ]
    # HSP转HAR指导

更新时间: 2025-12-16 16:34

HSP对bundleName和签名有一致性要求，在调试阶段需要先安装HSP包，这导致多模块集成开发场景下容易出现多种集成问题。在此场景下，建议使用HAR包来提供所需功能。本文通过配置项的变更将HSP工程变成HAR工程。

说明

阅读本文前，请开发者完成[HSP](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp)、[HAR](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package)、[module.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file)、[hvigorfile.ts](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-config-ohos-guide)、[oh-package.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-oh-package-json5)、[build-profile.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile-app)学习。

部分组件和模块在HAP、HSP、HAR中集成使用时存在差异，例如[加载HAR中Worker线程文件相比HSP存在单独的使用约束](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)，因此按照如下步骤完成HSP转HAR后，请关注对应组件和模块介绍并进行适配。

## HSP转HAR的操作步骤

1. 修改HSP模块下的module.json5文件，将type字段值改为har，删除deliveryWithInstall和pages字段。
    
    1. // MyApplication\library\src\main\module.json5
    2. {
    3.     "module": {
    4.         "name": "har",
    5.         "type": "har",
    6.         "deviceTypes": [
    7.         "tablet",
    8.         "2in1"
    9.         ]
    10.     }
    11. }
    
2. 在resource\base\profile文件夹下，删除main_pages.json文件。
    
3. 修改HSP模块的hvigorfile.ts文件，将内容替换为以下内容。
    
    1. // MyApplication\library\hvigorfile.ts
    2. import { harTasks } from '@ohos/hvigor-ohos-plugin';
    
    3. export default {
    4.     system: harTasks,  /* Built-in plugin of Hvigor. It cannot be modified. */
    5.     plugins:[]         /* Custom plugin to extend the functionality of Hvigor. */
    6. }
    
4. 修改HSP模块的oh-package.json5文件，删除packageType配置。
    
5. 修改项目级的配置文件 build-profile.json5，在 modules 模块下找到 HSP 的配置信息，删除 HSP 配置下的 targets。
# HAP转HAR指导

更新时间: 2025-12-16 16:34

HAP不支持导出接口或ArkUI组件给其他模块或应用使用，如果需要导出模块中的接口或ArkUI组件，并将模块作为二方库、三方库共享给其他模块或应用，可以使用HAR。本文介绍如何通过配置项的变更将HAP工程变成HAR工程。

说明

部分组件和模块在HAP、HSP、HAR中集成使用时存在差异，例如[加载HAR中Worker线程文件相比HSP存在单独的使用约束](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)，因此按照如下步骤完成HAP转HAR后，请关注对应组件和模块介绍并进行适配。

## HAP转HAR的操作步骤

1. 修改HAP模块下的[module.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file)文件，具体操作如下：
    
    - 将type标签值改为har，删除mainElement、deliveryWithInstall、installationFree和pages标签。
    - 由于API version 17及之前版本HAR不支持创建任何ExtensionAbility，从API version 18开始HAR仅支持创建[两种ExtensionAbility](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-add-new-ability#section18891639459)，因此在API version 18及之后版本但未配置为支持的两种ExtensionAbility、或在API version 17及之前版本，需要删除extensionAbilities标签，并将关联的ExtensionAbility组件删除或迁移到其他HAP模块中。
    - 由于HAR模块在API version 13及以下不支持UIAbility，因此在API version 13及以前的版本，需要删除abilities标签，并将关联的UIAbility组件删除或迁移到其他HAP模块中。
    
    1. {
    2.     "module": {
    3.         "name": "har",
    4.         "type": "har",
    5.         "deviceTypes": [
    6.             "phone",
    7.             "tablet",
    8.             "2in1"
    9.         ]
    10.     }
    11. }
    
2. 在HAP模块的src\main\resource\base\profile文件夹下，删除main_pages.json文件。
    
3. 修改HAP模块的hvigorfile.ts文件，将内容替换为以下内容：
    
    1. import { harTasks } from '@ohos/hvigor-ohos-plugin';
    
    2. export default {
    3.     system: harTasks,  /* Built-in plugin of Hvigor. It cannot be modified. */
    4.     plugins:[]         /* Custom plugin to extend the functionality of Hvigor. */
    5. }
    
4. 在HAP模块的根目录下创建名为Index.ets的文件，并在模块的oh-package.json5文件中的main标签配置该文件。Index.ets文件用于导出ArkUI组件或接口，详细导出方法参见[HAR-开发](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package#%E5%BC%80%E5%8F%91)。
    
    1. {
    2.     "main": "Index.ets"
    3. }
    
5. 修改项目级的配置文件[build-profile.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile-app)，在 modules 标签下找到HAP的配置信息，并删除HAP配置下的 targets。
# 创建应用静态快捷方式

更新时间: 2025-12-16 16:34

随着应用的功能越来越复杂，用户在使用应用时，找到某个功能的操作步骤也变得更加繁琐。为提升用户体验，可以对应用中常用的功能创建对应的桌面快捷方式，以达到快速启动应用、一键直达特定功能等目的。例如相机应用的 “快速拍照”、便签应用的 “新建便签” 和地图应用的常用地点导航等功能的快捷方式，用户通过快捷方式可以快速进入特定功能页面，既能大大提高操作效率，同时也增加了用户对应用的依赖性。使用快捷方式，还可以实现个性化定制的需求，创建多个快捷方式，以满足个性化的工作流程和操作偏好。

## 场景介绍

以导航场景为例，用户使用地图应用导航时，通常先搜索目的地，然后开始导航。为了提升导航效率和操作便捷性，建议在地图应用中添加常去地点的快捷方式，如公司、家等。添加这些快捷方式后，用户长按应用图标，即可打开快捷方式入口，快速启动导航。详情请参考[桌面快捷方式](https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-desktop-shortcuts)。

## 配置方法

下面介绍在工程中配置静态快捷方式的方法。

1. 在entry/src/main/resources/base/element/string.json配置资源文件如下。
    
    1. {
    2.   "string": [
    3.     // ···
    4.     {
    5.       "name": "share",
    6.       "value": "分享好友"
    7.     },
    8.     {
    9.       "name": "add",
    10.       "value": "添加收藏"
    11.     }
    12.   ]
    13. }
    
2. 配置快捷方式文件。
    
    在模块的/resources/base/profile/目录下配置[快捷方式的配置文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#shortcuts%E6%A0%87%E7%AD%BE)，如shortcuts_config.json，拷贝示例代码需要删除注释。
    
    1. {
    2.   "shortcuts": [
    3.    {
    4.       "shortcutId": "id_test1",  // 标识快捷方式，在应用有多个快捷方式时，该字段可作为快捷方式的唯一标识符，不支持通过资源索引的方式（$string）配置该字段
    5.       "label": "$string:add",  // 标识该快捷方式对外显示的名称
    6.       "icon": "$media:add_icon",  // 标识该快捷方式对外显示的图片，需要在entry/src/main/resources/base/media中添加名称为add_icon的图片
    7.       "wants": [
    8.         {
    9.           "bundleName": "com.ohos.hello",   // 对应该快捷方式对应拉起组件的包名
    10.           "moduleName": "entry",    // 对应该快捷方式对应拉起组件的模块名
    11.           "abilityName": "EntryAbility1",   // 对应该快捷方式对应拉起组件的组件名
    12.           "parameters": {
    13.             "testKey": "testValue"   // 表示拉起快捷方式时的自定义数据
    14.           }
    15.         }
    16.       ]
    17.     },
    18.     {
    19.       "shortcutId": "id_test2",  // 标识快捷方式，在应用有多个快捷方式时，该字段可作为快捷方式的唯一标识符，不支持通过资源索引的方式（$string）配置该字段
    20.       "label": "$string:share",  // 标识该快捷方式对外显示的名称
    21.       "icon": "$media:share_icon",  // 标识该快捷方式对外显示的图片，需要在entry/src/main/resources/base/media中添加名称为share_icon的图片
    22.       "wants": [
    23.         {
    24.           "bundleName": "com.ohos.hello",   // 对应该快捷方式对应拉起组件的包名
    25.           "moduleName": "entry",    // 对应该快捷方式对应拉起组件的模块名
    26.           "abilityName": "EntryAbility",   // 对应该快捷方式对应拉起组件的组件名
    27.           "parameters": {
    28.             "testKey": "testValue"   // 表示拉起快捷方式时的自定义数据
    29.           }
    30.         }
    31.       ]
    32.     }
    33.   ]
    34. }
    
3. 在应用的module.json5文件中配置metadata，指向快捷方式的配置文件。
    
    1. {
    2.   "module": {
    3.   // ...
    4.     "abilities": [
    5.       {
    6.         "name": "EntryAbility",
    7.         "srcEntry": "./ets/entryability/EntryAbility.ets",
    8.         // ...
    9.         "metadata": [
    10.           {
    11.             "name": "ohos.ability.shortcuts",  // 配置快捷方式，该值固定为ohos.ability.shortcuts
    12.             "resource": "$profile:shortcuts_config"  // 指定shortcuts信息的资源位置
    13.           }
    14.         ]
    15.       }
    16.     ]
    17.   }
    18. }
    

安装应用后，长按桌面上的应用图标，图标上方会显示开发者配置的快捷方式：“添加收藏”和“分享好友”。点击相应标签，可启动对应的组件。应用配置的静态快捷方式在桌面上的展示效果如下图所示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216163415.19335375957193123926949312996683:50001231000000:2800:44242D3E5F254E7DAADE997B1142B0B81B96CF1FC02875CB3AFF6B097CC7FCF8.jpg)

[  
](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-to-har "HAP转HAR指导")
