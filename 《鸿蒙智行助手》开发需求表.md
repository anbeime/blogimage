### **《鸿蒙智行助手》开发需求表 (V2.0)**

**项目概述：** 本项目旨在开发一款基于HarmonyOS NEXT的原生应用——“鸿蒙智行助手”。它深度整合高德地图HarmonyOS SDK，并充分利用鸿蒙的分布式能力、原子化服务和情景感知，打造一个**主动、无缝、多端协同**的下一代智能出行体验。应用将严格遵循《出行导航类-应用设计最佳实践》指南进行设计。
[[高德智能体（Agent）的提示词模板]]
**核心设计原则（来自文档）：**
[[鸿蒙智行助手锁屏卡片业务开通申请]]
1. **多端适配：** 手机使用底部半模态面板，折叠屏/平板使用侧边半模态面板，支持多档位高度调节。
    
2. **高效体验：** 充分利用屏幕空间，减少对地图的遮挡，提供沉浸式地图浏览体验。
3. **服务直达：** 通过原子化服务卡片和实况窗，将核心信息前置，减少操作层级。

---

### **一、 页面与模块详细需求**

#### **1. HomePage: 首页页面**

- **设计规范：** 采用地图为底，**底部半模态面板（手机）** 或 **侧边半模态面板（折叠屏/平板）** 的设计。
    
- **默认面板高度：** 手机/折叠屏为“中”高度，平板/PC为“高”高度，以充分发挥屏幕优势。
    
- **模块实现：**
    - **TravelPlanQuickEntryModule (带搜索按钮的搜索模块):**
        - **功能：** 位于面板顶部，点击后面板上滑至“高”档位，展开搜索界面。集成高德 `place` (关键字搜索) 和 `poi_to_geocode` (地址转坐标)。
        - **交互：** 支持语音输入。搜索结果列表在面板内展示，点击结果后，面板下滑至“中”档位，地图定位并展示地点详情（**范式一：面板覆盖**）。
            
    - **CommonRoutesRecommendationModule (常用路线推荐模块):**
        - **功能：** 基于用户历史行程（`MyTripsPage`数据），在面板“中”高度时展示2-3条“家->公司”、“家->常去商场”等智能推荐。
        - **交互：** 点击任一推荐，直接调用高德 `plan_driving`/`plan_integrated` 等API进行规划，并进入`TravelPlanPage`。
    - **TransportModeSelectModule (出行方式选择模块):**
        
        - **功能：** 在面板上提供驾车、公交、步行、骑行、电动车等图标快捷入口。
        - **交互：** 点击后，若已有点选起终点，则立即按该方式重新规划路线；若没有，则记录为下次规划的默认偏好。
    - **SmartRecommendationModule (智能出行规划模块):**
        
        - **功能：** **情景感知入口**。当系统检测到用户有即将开始的日历事件（需授权），此模块在面板中主动显示：“**前往[事件地点]？**”，并附有基于实时路况(`RealtimeTraffic`)的预估时间。
        - **交互：** 点击后，直接以日历事件地点为终点，当前位置为起点，调用高德API规划路线，并进入`TravelPlanPage`。

#### **2. TravelPlanPage: 出行规划页面**

- **设计规范：** 路线规划结果默认以**面板“中”高度**显示，同时展示面板内的路线建议和地图中的路线展示。
    
- **模块实现：**
    - **TransportationModeSelectModule (交通方式选择模块):**
        - **功能：** Tab栏形式，展示驾车、公交、步行、骑行等所有规划结果。调用对应的高德 `plan_*` 系列API。
        - **交互：** 切换Tab时，地图上的路线和面板内的详情联动更新。
    - **DepartureTimeSettingModule (出行时间设置模块):**
        - **功能：** 提供“现在出发”、“未来出发”（选择时间）、“到达时间”等选项。
        - **交互：** 选择未来时间后，重新调用高德API获取预测路况下的路线规划。
    - **RouteRecommendationModule (智能出行规划模块):**
        
        - **功能：** 展示规划结果的详细列表，包括各方案的距离、时间、费用（公交）、红绿灯数等。顶部展示系统推荐的“最优方案”。
        - **交互：** 点击某方案，地图聚焦该路线。提供“开始导航”按钮，点击后跳转至全屏导航界面，并可选发送至车机/手表。

#### **3. MyTripsPage: 我的行程页面**

- **设计规范：** 全屏页面，无半模态面板。
- **模块实现：**
    - **RecentTripOverviewModule (用户信息概览与多功能入口组件):**
        - **功能：** 展示用户头像、昵称，及“我的车辆”、“我的地址”等快捷入口。
    - **TripHistoryListModule (历史行程模块):**
        - **功能：** 列表形式展示用户过往的导航记录（起点、终点、时间、出行方式）。数据本地存储。
        - **交互：** 点击某条记录，可快速重新规划该路线。
    - **FavoriteRoutesModule (简易订单信息展示模块):**
        - **功能：** 展示用户收藏的路线或常用地址（家、公司）。
    - **TripStatisticsModule / TravelReportEntryModule (智能出行规划模块):**
        - **功能：** 展示出行统计（如月度里程、碳减排量）或生成出行报告入口。_（此模块为增值功能，MVP可简化）_

#### **4. MyPage: 我的页面**

- **设计规范：** 常规设置页面。
- **模块实现：**
    - **UserProfileModule (会员信息展示模块):** 账号管理。
    - **PreferenceSettingsModule (偏好设置模块):** 设置导航偏好（如避开高速、避免收费）、单位、语音播报等。
    - **AddressManagementModule (智能出行规划模块):** 管理家庭、公司等常用地址。
    - **HelpFeedbackModule (智能出行规划模块):** 帮助与反馈。

---

### **二、 鸿蒙核心特性与高德API集成需求**

|特性分类|鸿蒙能力/组件|对应高德API|实现功能|所在页面/场景|
|---|---|---|---|---|
|**多端协同**|`@ohos.distributedDeviceManager`  <br>`@ohos.distributedData.KVStore`|无（同步应用状态）|将“导航任务”作为分布式对象，在手机、车机、手表间无缝迁移和状态同步。|导航过程中|
|**原子化服务**|**服务卡片** (`@ohos.formHost`)|`RealtimeTraffic`  <br>`plan_driving` (预加载)|**桌面卡片1（通勤）**: 显示“家->公司”实时路况与ETA。  <br>**桌面卡片2（日程）**: 显示下一个日历事件的出行建议。|桌面、负一屏|
|**情景感知**|`@ohos.commonEvent` (系统事件)  <br>`@ohos.bundle.manager` (日历权限)|`poi_to_geocode`  <br>`plan_driving`|监听日历事件、时间变化。在事件开始前，主动查询路况并推送通知建议。|系统全局|
|**主动服务**|**实况窗** (`LiveViewKit`)|`Navigation` (导航状态)|在导航过程中，以胶囊和卡片态在通知中心持续显示关键信息（下一路口、ETA）。|导航过程中|
|**UI适配**|**响应式布局** (ArkUI)  <br>**半模态面板** (`@ohos.bindsheet`)|无|根据手机、折叠屏、平板、车机等不同设备，自动适配底部/侧边面板、布局结构。|所有页面|
|**核心地图服务**|**高德HarmonyOS SDK** (基础地图)|`MapView`|显示地图、缩放、平移、定位。|HomePage|
|**核心LBS服务**|无|`plan_driving`/`walking`/`integrated`等|路径规划。|TravelPlanPage|
||无|`search_around`|搜索周边POI（加油站、停车场）。|导航中/规划页|
||无|`RealtimeTraffic`|获取实时路况。|规划页/卡片|

---

### **三、 非功能性需求与开发规范**

1. **权限申请：** 必须明确申请并说明 `ohos.permission.LOCATION`, `ohos.permission.APPROXIMATELY_LOCATION`, `ohos.permission.INTERNET` 等权限的使用场景。
2. **隐私合规：** 严格遵守鸿蒙隐私规范。位置信息仅用于导航和规划，本地化存储行程历史，未经用户明确同意不上传。
3. **多端部署：** 使用ArkUI一次开发，通过响应式布局和组件能力适配手机、平板、车机等不同设备类型。
4. **性能要求：** 地图渲染流畅，路径规划API调用响应迅速，分布式数据同步延迟低。
5. **遵循设计指南：** 所有交互，特别是半模态面板的拖动、收起、展开，地点详情的展示范式（范式一/范式二），必须严格遵循《出行导航类-应用设计最佳实践》文档。

### **四、 开发优先级建议 (MVP)**

1. **Phase 1 (核心体验):** 实现 `HomePage` 和 `TravelPlanPage`，完成基于高德SDK的地图展示、地点搜索、多模式路径规划，并正确实现**半模态面板**交互。
2. **Phase 2 (鸿蒙特性):** 实现**原子化服务卡片**（显示实时路况）、**分布式导航接力**（手机->车机模拟器）、**情景感知通知**（基于日历的出发提醒）。
3. **Phase 3 (体验完善):** 开发 `MyTripsPage` 和 `MyPage`，实现**实况窗**，并优化多端（如手表）的UI适配。

**总结：** 此需求表将您的模块设计与鸿蒙官方设计规范、高德API能力进行了精准对齐，确保开发出的应用不仅是功能集合，更是符合鸿蒙生态设计语言和交互范式的原生精品应用。
根据《鸿蒙智行助手》开发需求表，结合HarmonyOS NEXT特性与高德SDK集成要求，以下是关键实现建议：

**一、核心组件实现要点**
1. **半模态面板交互**
    - 设备适配逻辑：
```typescript
// 设备类型判断
import deviceInfo from '@kit.DeviceInfoKit';
let displayType = deviceInfo.display.getDefaultDisplaySync().type;
// 设置初始高度
let panelHeight = (displayType === deviceInfo.DisplayType.TABLET) ? '80%' : '50%';
```

2. **高德API集成规范**
- 地图组件初始化：
```typescript
import amap from '@kit.AMapKit';
// 创建地图实例
amap.createMapView({
  context: this.context,
  mapType: amap.MapType.NORMAL,
  zoomControls: true
});
```

**二、分布式能力实现**
1. **导航任务跨端迁移**
```typescript
import distributedKVStore from '@kit.DistributedDataManager';
// 创建分布式KVStore
let kvManager = distributedKVStore.createKVManager({
  bundleName: 'com.example.navigation'
});
let storeId = 'navigation_status';
// 同步导航状态
function syncNavigationState(routeData: object) {
  kvManager.put(storeId, 'current_route', JSON.stringify(routeData));
}
```

**三、原子化服务开发**
1. **实时路况卡片**
```typescript
import formHost from '@kit.FormKit';
// 卡片数据更新
function updateCommuteCard(cardId: string) {
  let formData = {
    "eta": "30分钟",
    "trafficStatus": "缓行"
  };
  formHost.updateForm(cardId, formData);
}
```

**四、注意事项**
1. **权限配置**
需在`module.json5`中声明：
```json
"requestPermissions": [
  {
    "name": "ohos.permission.LOCATION",
    "reason": "用于路径规划和实时导航"
  },
  {
    "name": "ohos.permission.APPROXIMATELY_LOCATION",
    "usedScene": "快速定位"
  }
]
```

2. **响应式布局方案**
- 折叠屏适配策略：
```typescript
@Builder AdaptPanel() {
  if (this.deviceType === 'foldable') {
    Column() {
      // 侧边面板内容
    }.width('40%').height('100%')
  } else {
    Column() {
      // 底部面板内容
    }.width('100%').height('50%')
  }
}
```

**五、性能优化建议**
1. **地图渲染优化**
    - 使用离屏地图预加载技术
    - 对路径规划结果进行本地缓存（TTL设置5分钟）
    - 限制POI搜索接口的并发请求数

2. **数据同步策略**
- 分布式KVStore设置同步频率阈值为500ms
- 对导航状态数据采用差异同步机制

该方案严格遵循HarmonyOS NEXT设计规范，建议按照MVP阶段规划分步实施，重点保证位置服务与分布式能力的稳定性。在Phase1开发阶段，建议优先完成高德SDK的基础集成与核心页面交互逻辑验证。