# 整体界面布局及概念

更新时间: 2025-12-16 15:59

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155933.87712817771273717737636460370036:50001231000000:2800:2981444E9A9328ED6511858FCF838E06F47201A26DFE8E6C8D97378F3ADA8E29.png "点击放大")

DevEco Profiler工具的界面分为两大区域：

①[会话区](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-session)：负责调优会话的管理。会话区提供了性能实时监控工具Realtime Monitor来帮助开发者先明确问题场景，完成问题的发现和初步定界。开发者可以在会话区选择待调优的设备、应用及当前应用进程，当前已创建的调优分析任务将在下方以列表的形式展示。

每个会话是一份独立完整的性能数据单位，是由开发者通过一次录制得到的，同一个会话中的各种数据经过工具的处理可以互相关联，而不同会话间的数据，由于来自不同时间段的录制，不会具备关联关系。实时监控本质上也是一种会话，是由实时监控这个场景模板创造而成的。录制会话时需要注意，确保场景复现完整后再结束该次会话的录制。

同时会话区提供Frame、Launch等一系列场景化分析任务类型，帮助开发者有针对性的采集并展示更多更详细的数据，这些数据将会还原对应场景下的应用运行状况。

②[数据区](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-data)：负责性能数据的可视化呈现。包含工具控制栏、时间轴、泳道区域、详情区域，通过不同泳道展示，直观展示调优详情。
# 会话区

更新时间: 2025-12-16 15:59

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.44539944034284046172635273385430:50001231000000:2800:0412DFE55FB0D4274F6644DB7AA6EABD2E0301763D433EA93DB95E004DE181B2.png "点击放大")

DevEco Profiler左侧为会话区，可以分为三个部分：

① 调优目标选择区域：选择设备及要分析的应用和进程。

选定被调优的设备、应用包及应用进程作为后续调优会话的分析对象。依次点击设备、应用、进程列表完成选择。

② 会话列表区域：列出当前已创建的调优分析会话。

单击列表中的会话后，界面右侧数据区将显示其数据内容。选择设备、应用和进程后，此处默认显示“Realtime Monitor”任务。

会话区将记录当前所有的会话。每一个会话都会包含：会话的名称(图例中的"Launch")、会话当前状态(图例中的"Recorded")、会话对应的录制时长信息(图例中的"7s 605ms")。会话支持拖拽方式调整顺序。

**录制/删除会话**：通过鼠标悬停在名称后方的信息图标![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.05285376359512728857178716011686:50001231000000:2800:4E160BEB2D4F27017D45123A75D0F8778D237CD6084C9453E62145D683FAC1A5.png)上，会话所要观测的调优对象的基本信息将会以Tooltip的形式展示。点击会话的右侧的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.63861671137809118781582068029970:50001231000000:2800:064D43C9E819D25A6AFCBE9DFF7BBEDEEDB35A9F58111552BDEAD7EC1008EEAD.png)/![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.69911188143805603501564704943077:50001231000000:2800:53A90B53D7B23FD04307C1E64FFF6BF8C7D40A2391F7E02B66834F0F8F3CA205.png)按钮，开启/停止会话录制，此时工具开始抓取性能数据，开发者可以操作应用复现性能劣化场景；点击![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.90791050725808177619075993531938:50001231000000:2800:79772C0C05C6993373CBDD56F456A7530172FFBDA71D1026C58D632C76CD702F.png)将删除该会话。

说明

- 会话区存在两种会话类型：活跃会话和历史会话。活跃会话可在此区域内直接看到，历史会话需要点击界面下方**View Successful Sessions**前往查看。开发者主动选择新的调优目标后，活跃会话会清空，相关会话进入历史会话。
- 历史会话中支持删除会话和数据导出。
- 仅成功录制或导入的session可长期存留在任务列表中；录制失败或未启动录制的session，在设备/应用切换时自动从任务列表中清除。
- 会话录制完成出现![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.09005164801786605229135501722654:50001231000000:2800:5999A7FEFE5CFA48D05C217D6DCC3D9D38C232B2B3027EC215DC43775F5B4E33.png)图标，表示数据处于解析状态，请耐心等待解析完成。
- 支持的最大会话个数（活跃会话个数 +历史会话个数总和，重复不计入）为15个。

**数据导出**：待数据解析完成后，会话便会进入数据展示状态，将数据可视化的展示到右侧的数据区中。此时可以点击会话面板中出现的数据导出按钮![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.24754558950750800180406752660556:50001231000000:2800:A242685B5D5CD2C09486BEAA46A6C5ABD7B99A953FCE707419C56CA325F9F450.png)，将录制到的数据导出到本地进行保存，借助这个能力，开发者可以方便的在团队内共享录制到的性能数据，也可以防止采集到的性能数据丢失。

**智慧调优**：提供[智慧调优](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ai-profiler)功能![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.18298387448101018285230905855897:50001231000000:2800:BF162E460F8D89315BB6A636DE48F3B5D05ACDF09192EAB293C0348170672E90.png "点击放大")，支持通过自然语言交互，分析并解释当前实例或项目中存在的性能问题，帮助开发者快速定位影响性能的具体原因，目前支持对Launch、Frame、Allocation、Snapshot模板进行智慧调优分析。

③ 场景化模板选择区域：新建会话的入口，DevEco Profiler提供[Frame](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-frame)、[Launch](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-launch-overview)、[Snapshot](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-snapshot)、[Allocation](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-allocations)、[ArkUI](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-arkui-analysis)、[Energy](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-energy)、[ArkWeb](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-arkweb)、[Network](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-network)、[Concurrency](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-parallel-concurrency-analysis)、[GPU](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-gpu)、[Time](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-time)、[CPU](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-cpu)等场景化分析模板，提供对不同性能问题场景的数据分析方案。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.36244147370039194065862217812284:50001231000000:2800:A99F5A7A2C1AEA88333DEA071A16DB464D2FC244CDCAF59276BF8B7E50C9C273.png)：Frame卡顿丢帧场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.36172693071815057097586442598077:50001231000000:2800:5CCE0F2A471E1DC490F2191006538CDB7CC6D919FC3D60153B342805A9792DA0.png)：Launch冷启动场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.75456723091703080606908549417033:50001231000000:2800:1C52D7C365A2BADC2789F343A1A131854778B643C61DD00632B994E8E703A0C9.png)：Snapshot ArkTS内存泄漏场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.30121289365341158728235945185353:50001231000000:2800:9B5014F5CF7F50E8919FD246FFB2F5166E3120BA397F22346B2D67A62B071586.png)：Allocation Native内存泄漏场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.80193981776075241815564862680332:50001231000000:2800:E11210D9638AF5D658ECDACD29D54D24D3775C3A267B45BEBAFBCCF42B14D48B.png)：ArkUI卡顿丢帧场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.00621446422857975062914641750711:50001231000000:2800:ED9E38309A4689ADD2ADDBD5C5D3160A5149733D614A1184E52DA76C0F6A3A4F.png)：Energy能耗诊断场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155940.02442384627520304619121423431824:50001231000000:2800:8DBACE6E5ED65E9BA80E6C385FDC618741C73D3438C165866494011B006310E8.png)：ArkWeb加载丢帧场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.13725556696176587094316661962801:50001231000000:2800:ECC879814286C0A7B34AAD8449B5B6F62CDAF0BD9DF769E4B280DDE1EFFDBE9A.png)：Network网络诊断场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.01127688050542016628585846186739:50001231000000:2800:7CC5D117B14E893025D8374E3D63B1D4EF5B1BB4D7207E5BBB0D8D59D55FAD01.png)：Concurrency并行并发场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.56134276163752914209624461817888:50001231000000:2800:96C04B71B98E411A850E8B07BBD6910DCFFB82F73C1DD4B1B9A3B29911F9DACA.png)：GPU活动场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.48711364214163244649056166711009:50001231000000:2800:519643B78A55217E7187AE8D7034981931D2610789E25AA034B81B094F03499A.png)：Time函数耗时场景化模板。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.64281150107753079524229553538978:50001231000000:2800:B57C2AF879D9C907E0053ED843B47558CF517129BCD1C1A85F9E54C35E4C12B5.png)：CPU调度场景化模板。

选中任意模板图标，点击下方**Create Session**按钮，即可创建出一个全新的会话。

**数据导入**：在③ 场景化模板选择区域，点击**Open File**按钮，即可选择数据进行导入。当前支持.insight，.htrace， .ftrace，.heapsnapshot，.rawheap, .sys，.perfdata，.data，.nas（包含Native Allocation数据的文件），.txt（包含Native Allocation数据的文件）文件的导入。

**配置Profiler缓存路径**：在③ 场景化模板选择区域，点击左上方![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.66363019100244679617370000989676:50001231000000:2800:8D2EA12F1857B7DBB93E2A153F99F9BCB84697C19E540E980F1233B7D2D368B0.png)设置按钮，会弹出文件选择器，设置Profiler缓存文件的保存路径。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.60236282562067905070747842059380:50001231000000:2800:B088DE38F008E1C37BC78F633E78FAD1B306B53CACC11D582C70FE8DC49F3F6A.png)
# 数据区

更新时间: 2025-12-16 15:59

在数据区域，DevEco Profiler提供了对性能数据的可视化呈现结果。由于每个场景化模板所提供的可视化能力各不相同，本章节会主要就所有模板均通用的能力展开介绍。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.83903988570931804812668177375703:50001231000000:2800:BA9964CF2932E03C51B48D13EF759820A0B976A12EEC2591D518C856C363F14A.png "点击放大")

整个数据区可以分为五个区域：

① 工具控制栏：提供标记、收藏、离线符号导入、泳道过滤、泳道启动配置项等辅助功能的管理以及会话状态和时间轴的控制能力。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.10511271199520783056871070880424:50001231000000:2800:26A7CD0BF3265FEA7057739FF4A0BA31BC6F6C2BA47D821320D2D779E3269DD7.png)：标记列表按钮，点击后可以看到当前已放置的所有标记。可以查看/跳转到标记描述、时刻，支持修改标记的颜色。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.99745643916512403490382308068724:50001231000000:2800:9744ADA1F38EF5FC1C6CA3578F45584D242ABCE4F6FEEC2E50FCF95E580E90BF.png)：收藏泳道隐藏/折叠按钮，激活后隐藏/折叠收藏的泳道，置灰时为展示收藏的泳道。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.75252480761894972509240075258494:50001231000000:2800:F95C459E7979656E7404B2F70C14B6A43D427B6D7EF0CC1F744F0647861ACDF4.png)：离线符号导入按钮，点击后可以导入带有调试符号表的Native库，对应的Native函数栈符号将被还原，仅在Callstack和Native Allocation泳道中支持使用。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.18043500664310931836075531514883:50001231000000:2800:A49F839038641EBC6242530E3CB3B6F1F8DED0D48CE573A2E274CE68E6B67202.png)：泳道筛选按钮，点击可选择泳道进行过滤。筛选无需录制的泳道，可以降低数据采集本身的开销，但同时会造成数据分析维度的减少。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.26120333651751634052800584053787:50001231000000:2800:4A74286E7F37D20BA35F997AE00528F92EC3C080BE6CBF436DB72C6AFFF9AFD3.png)：泳道启动配置项，点击后展示不同泳道对应的插件启动配置信息。支持将配置信息保存到配置文件，后续使用该类型模板默认生效当前配置。

② 时间轴：提供横向时间轴，用于显示数据时间戳。

③ 标记栏：用于放置标记，能够帮助开发者标记时间点或时间段。

④ 泳道区：泳道图区域。每个场景化模板都会预置一系列泳道单元（例如上图的“Frame”便是一个泳道单元）。泳道单元是整个DevEco Profiler工具内，数据组织的最小独立单元，用于剖析应用某一特定维度的运行数据，每个场景化模板均是由一系列泳道单元组成，每个泳道单元都会呈现某一维度的性能数据。开发者可以查看数据随时间变化的特征，发现数据异常的时间段，支持框选时间段后在详情面板查看对应的细节。

说明

- 每个场景化模板的泳道单元，遵循Top-Down分析原则，越接近顶部的泳道单元，所观测的性能维度越抽象；越底部的泳道单元观测的性能维度则越接近于系统底层，建议按照自顶而下的顺序去分析泳道单元呈现的数据内容。
- 同一个泳道单元中，泳道区中主要展示时间维度的性能变化，帮助开发者首先定位出有问题的时间段；进而通过详情区查看该时段各维度的详细数据，分析具体影响性能的参数或属性。

⑤ 详情区：展示详细的数据细节。开发者在泳道区域选择数据之后，以各类表格的形式呈现该时间段内各项详细数据。**More**面板将对左侧详情区中选中数据进行补充描述。

## 基本操作

### 开启/关闭会话控制

在数据区，首先可以开启和结束会话的录制，点击工具栏的首个按钮即可，如下图所示分别对应开启录制、结束录制功能，第三个状态则代表录制完成。与在会话区域录制的功能效果一致。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.69569345719849213226102388059441:50001231000000:2800:61EDC827E3385F0560C3A0611C1087FAB58D1383CC47E46C308C78FB7327BA1F.png)

### 时间轴控制

DevEco Profiler工具提供了各种丰富的时间轴操作功能：

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.40275112561864430436873230353844:50001231000000:2800:F6149BEBAB97C0622450EDF1B4747E983A004ACF45147BD9A65DD053F6CB6A6E.png "点击放大")

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.86995060048048840520622508066699:50001231000000:2800:39421CD7928F39DB8210E40D3825FE8A6A46EF88D8636EC88014CAAC5CDD0694.png)：数据全量展示按钮，点击后时间轴尺度自动调整，将展示会话完整时间范围内的数据。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.77168919406008613791827770320330:50001231000000:2800:2CEA7EF51A649F8D1051E331EA5D02795FFD786E328E3B17DD9289C5D1B2D21E.png)：时间轴调整按钮（快捷键为W或使用Ctrl+鼠标滚轮），点击后时间轴所展示的时长将变小，更多数据细节会呈现。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.13998131595789963675537942005150:50001231000000:2800:FE3105BF89F3C279EF5BD52B75EAD8ACF0B7551A478BEEA22196104368DCADC9.png)：时间轴调整按钮（快捷键为S或使用Ctrl+鼠标滚轮），点击后时间轴所展示的时长将变大，更易于观测整体数据趋势。

拖动泳道区域下方的滑条(快捷键为A/D键或使用Shift+鼠标滚轮)，开发者可以调整时间轴所示的时间范围；拖动泳道右侧滑条（或者滑动鼠标滚轮），可以调整泳道单元上下滚动。具体快捷键使用方式请参见[快捷键](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-shortcut-key)。

说明

使用W/A/S/D等纯键盘的快捷键操作，仅在已激活的泳道区域生效。泳道区域中存在亮蓝色的选中边框即为激活状态。

### 查看详情面板

当开发者在泳道区域观察到可疑数据后，便可以通过框选或者点选的方式，将相关详细数据展示到详情面板中。泳道中条块状的数据支持点选查看，在泳道区域鼠标点击拖动再释放完成框选。可以在框选的同时按住Alt键，完成框选后时间轴尺度将会自动适应，整个框选时段会充满整个泳道区域，方便聚焦观察被选择的时段。

由于不同的泳道单元会展示不同维度的数据，因此详情面板展示的数据是来自于泳道区域中被选择的泳道单元。被选中的泳道单元会呈现蓝色，与其他泳道单元有明显差异。此外，当开发者直接选中泳道单元，而未进行框选或点选时，详情面板中会展示整个泳道单元的完整详细数据（效果等同于完整框选该泳道单元）。

### 添加/编辑标记

为了便于开发者记录分析出的关键时间点，DevEco Profiler工具提供了标记功能供开发者使用。

DevEco Profiler支持两种时间标记：

- 单点时间标记：单击需要关注的时间点，添加的时间标记显示为![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.27308494659604391972812837133588:50001231000000:2800:683D762923921CF83531ADE9E3126BBC7F8B12F0C56D3C7BD5103C4A13B54B6F.png)（快捷键为M，颜色可自定义）。
- 时间段时间标记：鼠标框选要关注的时间段，单击该时间段右上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.55356697524758653986580031980543:50001231000000:2800:3BCFE01FE7C7BABAE4CC1E9B78A971AAAFD2ACD69F0473A0468A5E65368090BB.png)添加时间段起始标记（快捷键为Shift+M，颜色可自定义），如下图所示。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155946.28170457962409448760768285101304:50001231000000:2800:8A025F72E3C53F6BB5FDCE51EC10DC92713F2CC378EDA9887250E29AAF392929.png)
    

开发者可以在时间轴下方的标记区域点击放置单个标记，也可以在框选时间段后，点击旗子按钮放置该时间段的标记，如下图所示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.71401035708220153881799244816623:50001231000000:2800:7597472715370AEFB18321F6BEECEA1C7F93DB178E4D444DFBEECB9DA2385FC4.png "点击放大")

支持使用“Ctrl+, ”向前选中单个标记，“Ctrl+. ”向后选中单个标记；“Ctrl+[ ”向前选中时间段的标记，“Ctrl+]”向后选中时间段时间标记。

标记放置完成后，可以通过双击标记按钮，在弹出的标记属性框中修改标记的描述和颜色信息，或者删除标记。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.95936864004464153771084364712828:50001231000000:2800:E04AE95618112EC8BC6760399E01D48E44B78104FB61E668D0DBEFEB44F8ED23.png)

此外，工具还提供了查看不同标记之间时间差的能力，只需要先选中一个标记，再鼠标悬浮在其他标记点上，便可在面板右下角![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.73362400449972439015443562627620:50001231000000:2800:A815AAE2960B37FC81179790103C11EFED5D1B8E50CD2E15CB3FB0A06C4112A6.png)后看到被悬浮的标记点和被选择的标记点的时间差。借助这个能力，开发者能够快速获知一些特定时刻的时间差，这对于分析时间敏感的性能问题尤其有用。

### 收藏泳道单元

在使用工具分析，可能会遇到泳道单元过多，导致想分析的泳道单元间隔过远、分析低效的情况，使用收藏功能，可以帮助开发者将关注的泳道单元提拉到泳道区域的顶端。将鼠标悬停在想要收藏的泳道单元之上，出现收藏图标![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.03415374105982360039696095871106:50001231000000:2800:7BC07A29919EA0B521885E981E5D3C89B3792E2B6A6C5D8A96593C4CFC6E87AD.png)，点击该按钮即可完成收藏。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.67952756157210248315163983216634:50001231000000:2800:D14605D41085862E83477D47141ADF1FE61D08A929CF454C4814CDD98F268A25.png)

再次点击该按钮则取消收藏。此外，由于顶部区域空间有限，工具还提供了压缩泳道的能力，点击泳道中![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.70931996790244576892245722593637:50001231000000:2800:C41760D7E8C3B0B17E84EAECBA1FD3CBBEAEBDF513909C9A3F8DD1FDE8AB2269.png)图标，可以将收藏的泳道单元进行折叠。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.36081852089256657153307807557499:50001231000000:2800:37D6E8C772491A83032BA42E6A98460B109B0B425125D9A76D76EBB876429ABE.png "点击放大")

如果收藏的是父泳道，且泳道标题展示不完整，当鼠标悬浮到泳道标题区，会提示该泳道的泳道标题信息。

如果收藏的是子泳道，且泳道标题展示不完整，当鼠标悬浮到收藏的子泳道标题区，会提示该泳道的父泳道和子泳道标题信息。

如果收藏的是子泳道，且泳道标题展示完整，当鼠标悬浮到泳道标题区，会提示该泳道的泳道标题信息。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.17482479130564138276401174644506:50001231000000:2800:9963C9DFCC27AD7866A3F13E6FF7E7310ADB9F5D60CAF08BF64235ACEE71F4F3.png "点击放大")

### 展开/折叠子泳道

工具提供了两种方式展开/折叠子泳道：

1、点击父泳道左边小三角符号![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.34297761044311078629532565421399:50001231000000:2800:6647FA07DB74B14F916C727FDF5B3C4FDBEB585C7876A1CE935E282AA74E5F0C.png)。

2、双击父泳道表头区展开泳道。

### 全局搜索

为了帮助开发者迅速查找关心的性能数据，DevEco Profiler工具提供了全局搜索功能。

1. 在搜索框选项区可选择搜索类型，支持搜索泳道和搜索泳道数据，默认搜索泳道数据。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.07091052729505095941609636446867:50001231000000:2800:70B2518B08A899201E34351A5FF429A85BD6779A052EDA54778D890C0A3761D0.png "点击放大")
    
2. 搜索泳道数据，在输入内容前或搜索到结果后希望进一步确认搜索范围，可以选择在全时段内搜索或者在框选的时间范围内搜索；也可以选择在所有泳道内搜索或者在选择的泳道范围内搜索。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.95785284296786000031846565799868:50001231000000:2800:6AB1415B8599052B3BA09EE5AF0F8722650B27ABC9E20F2965598901FFF9836F.png "点击放大")
    
3. 可以点击Cc按钮，设置输入的关键字是否忽略大小写，默认为忽略大小写，点击时可自动重新触发搜索，搜索结果数量会显示在搜索栏右侧。有搜索结果的关键字会自动被记录到历史记录中，开发者可以通过点击![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.07073715224352352768914780673047:50001231000000:2800:32A4ED7257500771D213A65C8B3A2F5F29155C3BD52BE6BFB06730EBFBFDAB43.png)或者![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.34095493276151182554034373583310:50001231000000:2800:933B8DCE993C649EC8E54BA1C19FE5EDC2FEC9E4813A4290CC99617878F35704.png)按钮，向前向后查看搜索结果，泳道区域会自动跳转到对应的结果位置并为开发者选中该结果，详情面板中会自动刷新出相应详细数据。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.65463109601580249696232124407719:50001231000000:2800:51AE6C0B2593E89DFCD519338EC91E5B07F90BDE916DC76F1D6265B05E4804AC.png "点击放大")
    

### 离线符号解析

为便于开发者分析Native的函数热点，工具提供了符号导入的能力，开发者可以点击工具控制栏的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.76708145682658198035989675069007:50001231000000:2800:B2F7F06A8051F470747936F827EAA40CAF2543A63DF0AF72CF22E0727C925D80.png)按钮，选择带有调试信息的so库导入，之后工具会利用此信息，将采集到的函数偏移信息转换为对应的源码符号（包括系统so库，用户自编译的so库，三方库）。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.13372569830677232310701023795111:50001231000000:2800:F2AFD843246C6D2BB74A7E5024D827AB24BFA3A49A5DA8B0903E99D846F0C9D6.png "点击放大")

说明

- 离线导入携带符号表信息的so库，需要严格保证与release版本的so库保持同一优化等级（如-O1, -O2, -O3等）。可以在CMakeLists.txt文件中查看或配置编译优化等级。
- 离线导入携带符号表信息的so库，需要尽可能与release版本的so库编译选项保持一致，防止so库起始地址不一致，影响解析正确性。

### 源码跳转

找到问题源码是调优过程中最为关键的一环。针对详情面板中所展示的函数栈帧信息（如下图所示），双击栈帧节点，工具便会在编辑器中打开相关源码文件，并定位到对应行号。此功能正常使用的前提是用于抓取性能数据的应用，是在DevEco Studio的当前工程开发编译，且相关源文件位置并未改变。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155947.75833113418954609187488436354263:50001231000000:2800:B8B0070F546E0DC52219EC0490E5978A04AB671646E088A403BB00047ACC2EE8.png)# 性能优化过程简介

更新时间: 2025-12-16 15:59

## 流程概览

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155933.78970667852729025485581568398493:50001231000000:2800:25BF92519D43F6421B80E4BE92FCE36C3A194D47149627BDDE64B06E7188C3E7.png)

在开发应用时，开发者会对应用的运行情况有一个预期的指标，当应用在某些方面不能满足预期的指标或者表现不佳时，意味着您的应用可能存在性能问题，需要对应用进行性能优化以达到您的预期。应用的性能优化是一个不断持续的周期性的过程，您需要在应用开发过程中观察应用的运行表现来识别性能瓶颈，通过运行时数据来定界定位性能问题，定位根因后修复代码并验证优化措施的可行性，循环往复直到应用满足您的性能指标。DevEco Profiler也遵循以上流程，在使用DevEco Profiler进行性能优化时，您可以参考以下过程：

1. 使用“Realtime Monitor”监控设备的各项资源使用情况，识别并定界潜在的性能瓶颈及热点区域，例如CPU占用超过预期、内存异常增大等；
2. 创建深度分析任务，通过详细的应用运行时数据，例如函数调用、内存对象等信息，来分析并定位性能问题出现的根因；
3. 根据性能分析的结果优化代码；
4. 再次使用“Realtime Monitor”查看各项资源的使用情况是否符合预期，来验证代码修改的可行性。
# 性能问题定界：实时监控

更新时间: 2025-12-16 15:59

解决性能问题，首先对当前应用的运行情况以及设备的资源消耗进行监测，以初步确定可能存在的性能问题以及问题出现的位置。

DevEco Profiler提供实时监控（Realtime Monitor）能力，该能力为您提供全方位的设备资源监测，覆盖系统事件、异常报告、CPU占用、内存占用、实时帧率、GPU使用率、温度、电流、能耗以及网络流量消耗等多个维度的数据，帮助您初步识别性能瓶颈，定界问题所在。

## 配置并确认设备环境

为了能够正确地监测您的设备资源，首先您需要通过USB完成设备连接，打开“开发者模式”并选择允许“USB调试”，然后通过DevEco Studio将您开发的应用安装到设备上。随后您可以通过如下步骤来查看应用的实时资源使用情况。

1. 您可以通过如下三种方式打开DevEco Profiler：
    
    - 在DevEco Studio顶部菜单栏中选择“View -> Tool Windows -> Profiler”。
    - 在DevEco Studio底部工具栏中单击“Profiler”。
    - 使用“Ctrl+Shift+A”（macOS中为双击“Shift”）打开搜索功能，搜索“Profiler”。
    
2. 在设备上启动您想要监测的应用。
3. 在DevEco Profiler界面左上角的设备、应用及进程列表中，选择调优设备及待调优的应用/元服务进程。如果您的应用不止有一个主进程（还存在Extension或者Render进程），那么您需要再手动选择一个您想要监控的进程。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.00099232016598746481868623000896:50001231000000:2800:F20E84834C2FAA3DED82223079D732E558A56474C5F9E8293B5A6D08550F6841.png)
    

## 实时监控应用，多维度对比识别性能热区

在实时监控界面，设备各项资源的使用情况均以泳道图的形式在时间维度展示，提供系统事件、CPU占用等多维度信息，帮助您识别性能热区。

### 面板整体介绍

- 界面左侧为实时数据展示区域，该区域的数据显示了每一项监测内容的瞬时值，并通过饼图或者仪表盘的形式让您更加直观地观察到各项数据的使用占比以及具体数值。
- 界面右侧则是各项数据随着时间推移的变化趋势，通过不同的图像形式（直方图、柱状图、折线图等）来更加清晰的展示某一项资源在一段时间范围内的变化趋势，以帮助您快速判断性能热点区域。

整个实时监控页面从上到下，依次展示了系统事件、异常事件、前台应用、CPU占用、内存占用、帧率、GPU使用率、温度、电流、能耗以及网络流量消耗等各个维度的数据，帮助您从多个维度来对比识别当前应用的性能热区。下面为您依次介绍每一条泳道的数据内容。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.51961086277676192642607417667338:50001231000000:2800:E6BB66F6A152D80B4891BC8C3F923E501350765FA027752E91BBE72FDF7F7D5E.png "点击放大")

### 泳道简介

1. System Events泳道：该泳道展示了时间窗内系统事件的起始、终止等状态的统计情况。泳道内存在三种形状的标识：
    - 菱形：表示事件开始。
    - 正方形：表示事件结束。
    - 圆形：表示当前为时间点事件，无持续时间。
2. Anomaly泳道：用于展示设备侧上报的各种异常事件。

3. Foreground Ability泳道：用于展示应用/元服务的Ability状态。当Ability在前台运行时，会在此时间段内显示该Ability的名称；若当前无前台运行的Ability，则此时间段内显示“Background”。
4. CPU泳道：左侧饼图展示了当前时刻应用/元服务的CPU使用率、其他进程的CPU使用率以及空闲情况。右侧的泳道图则展示了时间窗内的整体CPU使用情况，其中灰色的部分代表系统中其他进程的CPU占用，蓝色部分则展示了当前应用/元服务的CPU占用情况。

5. Memory泳道：左侧饼图展示了当前时刻应用/元服务的内存占用、其他进程的内存占用以及未使用的内存。右侧的泳道图则展示了时间窗内的整体内存使用情况，其中灰色的部分代表系统中其他进程的内存占用，蓝色部分则展示了当前应用/元服务的内存占用情况。
    - Current Process：当前时刻应用/元服务的内存占用。
    - Other Processes：其他进程的内存占用。在5.1 Release版本之前，cached缓存空间（内存会被系统自动回收）占用的内存被计入Other Processes内存中。
    - Free：未使用的内存。在5.1 Release版本及以后，cached缓存空间占用的内存被计入Free内存中。
        
        说明
        
        当前应用内存展示的是应用的PSS值，如需内存详细信息请参考[Native内存泄漏分析：Allocation分析](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-allocations)。此处的PSS值比hidumper略大，原因是hidumper计算过程中会执行取整操作，计算值偏小。
        
6. FPS泳道：左侧仪表盘展示了当前设备屏幕的帧率瞬时值，红色、黄色、绿色区域则代表当前屏幕帧率是否达标理想状态。右侧柱状图则展示了每一次采集设备帧率时的数值。该泳道仅支持在配备硬件屏幕的设备上进行数据采集。

7. GPU泳道：左侧仪表盘展示了当前设备GPU使用率的瞬时值，右侧泳道则展示了时间窗内的整体GPU使用率。
8. Temperature泳道：左侧温度计显示了当前设备温度信息，右侧泳道的数据采集周期为3秒，展示了时间窗内的设备温度信息以及温度等级。该泳道暂不支持在TV/2in1/Car设备上进行应用性能分析。

9. *Device Current泳道：左侧展示了当前设备最大电流、平均电流以及最新的电流值，右侧泳道则展示了时间窗内的设备电流信息。该泳道统计电池的电流会由于充放电导致电流为非准确的消耗值，使用*Device Current进行区分，若需要准确的消耗电流，可以在设备侧打开"关闭充电"，操作方式为**设置 > 系统 > 开发者选项**。该泳道暂不支持在TV设备上进行应用性能分析。
10. Energy泳道：该泳道包含了各项部件（包括CPU、*Display、GPU、Location、Camera、Bluetooth、Flashlight、Audio、Wifi、Modem）的周期内平均功耗占比。通过图例上方的下拉多选框则可以勾选您想要监控的功耗使用情况的应用，选择多个应用后，该泳道会展示所有您所选择应用的功耗总和。右侧区域柱状图则展示了时间窗内各部件资源的实时使用情况，柱状图的颜色代表每种部件的功耗占比。Display指标只能测量不同亮度的屏幕电流，无法精确测量不同明暗色的显示电流，为提示开发者，使用*Display来突出该差异。该泳道暂不支持在TV设备上进行应用性能分析。暂不支持展示Wearable设备GPU、Location、Camera、Flashlight的功耗占比情况。2in1设备暂不支持展示Location的功耗占比情况。

11. Network Traffic泳道：左侧区域内仪表盘展示了当前设备网络上行瞬时速率和下行瞬时速率，仪表盘右边展示了时间窗内上行总流量和下行总流量。右侧泳道柱状图则展示了时间窗内网络流量消耗的实时情况。

说明

FPS、GPU、Temperature、*Device Current泳道显示的是所使用设备的实时信息，而非当前调优应用/元服务的信息。

## 实时监控页面的常用操作交互方式

实时监控页面除了展示各个维度数据的瞬时值以及时间窗内的变化趋势之外，还提供了多种交互方式以供您更加便捷、快速、细致地分析您的数据。

- 启停控制
    
    点击会话区“Realtime Monitor”页签上的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.85614514734229711558436687995017:50001231000000:2800:F2EE4E289E13CD46CD1D0FBF5DBD2C5C00E6E9D8E327232480BEB31BFAE56966.png)、![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.16457558420159791511294645258600:50001231000000:2800:3F9B9C521CD44387E90F89C5F1FD92D84EF8BD58682029251C52C67311057B5E.png)按钮或工具控制栏上的 ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.99523063778436954645443184735676:50001231000000:2800:16833A2ED736823A614D5DCF981B67A8634576C582654E8AA13C5EA052C594F1.png)、![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.63144591094370170866105007323148:50001231000000:2800:7DDA3C4AEAA141344F05BA5BDE7EBE4E6D6336A5623F94AE858A2BA4D8304A80.png)来即时控制实时监控界面的录制状态。
    
- 泳道筛选
    
    点击工具控制栏上的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.65331909070188367707846678771071:50001231000000:2800:C348A22267F32B9C6AFA6FB206F007C4B82A7F52058C235B97FA9BB8395A6CC8.png)按钮，可以选择泳道进行筛选。筛选无需录制的泳道，可以降低数据采集本身的开销，但同时会造成数据分析维度的减少。
    
- 详细数据展示
    
    将鼠标悬浮于所关心的泳道数据上时，界面上会出现当前时间点的时间标线以及含有当前时间点上泳道详细数据的Tooltips。更进一步，当您将鼠标悬浮于时间轴上时，实时监控页面内的所有泳道均会以Tooltips展示出该时刻的数据。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155941.65226781933682775784975297818665:50001231000000:2800:9D138FFCC8F385C74282919B1101F730117DE8E23992E2F0711AF5B7231EF140.png "点击放大")
    

- 图例选择
    
    实时监控界面部分泳道内的图例均支持选择/反选来增加/去除泳道内这一数据的展示，能够更加专注地分析所关心的数据。
    

至此，通过分析实时监控的多维度数据，可以了解到当前应用的具体运行情况以及可能出现性能问题的热点区域。接下来，可以通过深度录制详细的应用运行数据来更加详细地分析应用可能存在的性能问题。
# 性能问题定位：深度录制

更新时间: 2025-12-16 15:59

## 创建深度分析任务并进行录制

开发者可针对不同的性能问题场景选择不同模式的分析任务，对应用/元服务进行深度分析。当前支持以下调优场景：

- Frame：主要用于深度分析应用/元服务的卡顿丢帧原因。
- Launch：主要用于分析应用/元服务的启动耗时，分析启动周期各阶段的耗时情况、核心线程的运行情况等，协助开发者识别启动瓶颈。
- Snapshot：支持多次拍摄ArkTS堆内存快照，分析单个内存快照或多个内存快照之间的差异，定位ArkTS的内存问题。
- Allocation：主要用于应用/元服务内存资源占用情况的分析，可深度采集内存相关数据，直观呈现不同分类的内存趋势，提供内存实例分配的调用栈记录，深入分析内存问题。
- ArkUI：主要用于定位由于组件耗时、页面布局、状态变量更新导致的卡顿问题。
- Energy：主要用于应用/元服务的能耗异常分析。
- ArkWeb：主要用于定位web应用加载和丢帧问题。
- Network: 主要用于定位http协议栈网络信息诊断，用于网络请求分段耗时分析。
- Concurrency：主要用于显示并行并发应用的实际运行情况，用于帮助优化并行并发代码。
- GPU：主要识别GPU利用率低以及执行图形和计算工作负载性能瓶颈的根本原因。
- Time：主要用于改进函数执行效率的分析，深度录制函数调用栈及每帧耗时等相关运行数据，并完整展现ArkTS到Native的跨语言调用栈，支撑Native API典型问题分析。
- CPU：通过深度采集CPU内核相关数据，直观地呈现出当前选择调优应用/元服务进程的CPU使用率、CPU各核心时间片调度信息、CPU各核心频率信息、CPU各核心使用率信息、系统各进程的CPU使用情况、线程状态及Trace信息等。

1. 选择场景模板，创建会话：
    
    新建任务的入口，DevEco Profiler提供Frame、Launch、Snapshot、Allocation、ArkUI、Energy、ArkWeb、Network、Concurrency、GPU、Time、CPU场景化分析任务类型。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.69966565566319683823800118519945:50001231000000:2800:9ADBA3D9AB80214DAF5731B969DE1FD21936BFF594E88A4F392638B187978D82.png)：在设备列表中选择设备。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.15032975618988137482557020213539:50001231000000:2800:C9ED5FD797E3F9BDDBAA3588CEE05C38E2AFA6BBBA727DEA54434384284A2F12.png)：在进程列表中选择要调测的应用（可以是正在运行的应用，也可以是已安装但未启动的应用）。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.15400187853484593357819119360742:50001231000000:2800:B1E8A615F007A004C2D202C0E46EAC4BC107E72817D9D657921EBF6AF42A7429.png)：在DevEco Profiler主界面的新建任务区域，单击要创建的场景调优分析任务类型，并单击“Create Session”。创建后的分析任务，将显示在界面左侧的任务列表中。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.50603896682764322280650480747652:50001231000000:2800:95D3192316896F832CC2085FF310099C559597C8B25F4CCFBB427ABDCAC317DE.png)：调优详情，显示具体的调优内容。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.64440392664294780753482577970025:50001231000000:2800:9AC1D0A1949EDC9BB603BBC8FF15A2D2E4C15F5376B0B68650142B30075923E9.png "点击放大")
    
2. 配置并确认会话环境：
    
    在右边录制详情区域，工具控制栏上有很多小图标，鼠标放上去会有一些功能提示，可以添加一些录制选项，各泳道区域也有下拉框选项，下拉选择不同的设置可以调整录制功能。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.12312136591786690641267333517396:50001231000000:2800:52D20C4BA9FFAE1C2E820715BAD82353E2BF320AF84EEF31F9C4452B14994108.png)
    
3. 启动录制，复现性能劣化场景：
    
    单击任务窗口左上角的 ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.63452219135748014472964579312977:50001231000000:2800:960AE29EB4CA169090730C39571BC5A3C11D7BB6D03101E702152D506EAC9CA1.png)，启动录制，也可以选择左侧的任务列表中的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.07856342979523168067445750916319:50001231000000:2800:85361C2AADE3CA9D7F03BAECE4F6213333CD6E00EDFFF805C633E4D50025A8CF.png)，启动录制后，等待任务状态由“initializing”变为“recording”。录制过程中整个DevEco Profiler不能再点击其他的模板进行操作，如果想录制其他模板可以结束本次录制重新选择其他模板开始录制。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.68546227147495596575769077462436:50001231000000:2800:2D3E2599EB9E99A69C9C35F415A037CE693D851C2C557274E155E4FE58119148.png "点击放大")
    
4. 录制场景结束，停止录制：
    
    在调优设备侧操作APP，执行要验证的操作，复现应用性能问题。单击该任务的停止按钮 ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.09426625591354239864838137436501:50001231000000:2800:95DF773784A80C97ADD278476703946EF2066F116EA37AF7C4E015535F326FD4.png)，进入数据解析阶段，所有泳道任务状态由“analyzing”变为“rendering”，解析结束，右侧调优详情区域显示具体调优内容，解析过程可能包含大量的数据，需要等待一段时间，请耐心等待解析完成。
    

当前的ArkTS Callstack/Callstack/Native Allocation/ArkTS Allocation泳道录制如果无值，泳道显示No Data，在泳道名称处可将光标悬浮于三角告警图标处，查看泳道报错的原因。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.42809416262300650540659343883529:50001231000000:2800:DFF97D110CD0072A42122C32D85049935522CE877F926AD9F58CCD3663D1D1DC.png)
# 基础耗时分析：Time分析

更新时间: 2025-12-16 15:59

## 函数耗时分析及优化

开发应用或元服务过程中，如果遇到卡顿、加载耗时等性能问题，开发者通常会关注相关函数执行的耗时情况。DevEco Profiler提供的Time场景分析任务，可在应用/元服务运行时，展示热点区域内基于CPU和进程耗时分析的调用栈情况，并提供跳转至相关代码的能力，使开发者更便捷地进行代码优化。

在设备连接完成后，可按照如下方法查看耗时分析结果：

1. 构建应用前请参考[模块级build-profile.json5文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile)，增加strip字段并赋值为false（strip：是否移除当前模块.so文件中的符号表、调试信息，配置为false代表不移除）。采集函数栈解析符号需要附带符号表信息，无符号表信息可能采集不到函数名称，或ArkTS Callstack泳道无法关联到Native调用栈，因此请按照下图进行配置。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.15923892254467632687957671238077:50001231000000:2800:C5958A2ADC2DF55EFCA4C5CA48F583ED6E0F0489C7C4A61548B911DFB8925558.png "点击放大")
    
2. 创建Time任务并录制相关数据，操作方法可参考[性能问题定位：深度录制](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording)。或在会话区选择**Open File**，导入历史数据。
    
    Time分析任务支持在录制前单击![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.29076711451280951479327752994922:50001231000000:2800:6B902C958A1505A7FBD668ED6146F850A8933EC6FA269F29C6BC4F1911FDDAFF.png)指定要录制的泳道：
    
    - **User Trace**：用户自定义打点泳道，基于时间轴展示当前时段内用户使用hiTraceMeter接口自定义的打点任务的具体运行情况。
    - **ArkTS Callstack**：方舟运行时函数调用泳道，基于时间轴展示CPU使用率和虚拟机的执行状态，以及当前调用栈名称和调用类型。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。
        
        调用栈分类从语言层面分为ArkTS、NAPI以及Native，从归属层面分为开发者代码以及系统代码。从这两个方面可以将调用栈类型归类如下：
        
        - ArkTS：程序正在执行ArkTS代码；
        - NAPI：程序正在执行的NAPI代码；
        - Native：程序正在执行的Native代码；
            
            其中每一个类型的亮色和灰色分别代表开发者和系统的代码。
            
    - **Callstack**：ArkTS和Native混合函数调用泳道。基于时间轴展示各线程的CPU使用率，以及在一段时间内的混合调用栈。调用栈类型会分为开发者或系统的ArkTS以及Native代码两类。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。
        
        Callstack基于采样模式采集数据，默认采样间隔是500微秒。耗时小于500微秒的函数，Details区域时间相关数据可能存在误差，可通过录制过程中多次触发该函数，根据其耗时百分比判断是否为热点函数。
        
    
    说明
    
    - 在任务分析窗口，可以通过“Ctrl+鼠标滚轮”缩放时间轴，通过“Shift+鼠标滚轮”左右移动时间轴。或使用快捷键W/S放大或缩小时间轴，使用A键/D键可以左右移动时间轴。
    - 将鼠标悬停在泳道任意位置，可以通过M键添加单点时间标签。
    - 鼠标框选要关注的时间段，可以通过“Shift+M”添加时间段时间标签。
    - 在任务分析窗口，可以通过“Ctrl+, ”向前选中单点时间标签，通过“Ctrl+. ”向后选中单点时间标签。
    - 在任务分析窗口，可以通过“Ctrl+[ ”向前选中时间段时间标签，通过“Ctrl+]”向后选中时间段时间标签。
    - 将鼠标置于ArkTS Callstack泳道和Callstack泳道任意位置，可查看到对应时间点的CPU使用率。
    - 单击任意泳道名称后方的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.98250414064494306478625479930150:50001231000000:2800:9A2F89E1B561A88D298EC22927A48EF05F74065BFE99C046C8F84588E90A1732.png)可将其置顶。
    - Time分析支持Energy泳道，请参见[能耗诊断：Energy分析](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-energy)。
    
3. 在“ArkTS Callstack”泳道和“ArkTS Callstack”子泳道上长按鼠标左键并拖拽，框选要分析的时间段。
    
    **Details**区域会显示所选时间段内的函数栈耗时分布情况，**Heaviest Stack**区域会展示出“Details”区域选择节点所处的耗时最长的完整调用栈。
    
    其中函数栈耗时分布有三种展现方式：
    
    - 默认为Call Tree方式，其中“Weight”字段表示当前函数的总执行时间，“Self”字段表示函数自身的执行时间，两者之差为当前函数所调用的子函数执行时间之和，“Average Duration”字段表示函数自身的平均执行时间，“Category”字段表示函数调用类型。
    - 打开页面下方的**Flame Chart**开关，函数调用栈将以火焰图的形式展示。其中，横轴表示函数的执行时长，纵轴表示调用栈的深度。
        
        说明
        
        - 火焰图条块支持搜索，搜索结果不匹配的条块会被置灰。
        - “Ctrl+鼠标滚轮”的操作，或单击该区域右上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.28380958006848885615386858214171:50001231000000:2800:2FDEE443257524B80DE3E4CE261BDAC2BB4122A16700FFEE02D4ABF154695DAA.png)、![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.26765780156910200724739419112153:50001231000000:2800:576844D0FAEDC006D76E66CB7FC64A624FAA439C09ACBCCAC1EABC3AF473A712.png)可放大和缩小火焰图的时间轴比例，单击![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.82719187058287699922378304258883:50001231000000:2800:EB9E6836708B384A0E7E8B2AEED8B7A74D6AE7C702CC6CDC04F953FC99D365C7.png)可恢复时间轴比例为初始状态。
        - “Shift+鼠标滚轮”的操作可左右横向调整可视区间，单独操作滚轮可上下纵向调整可视区间。
        - 选中节点，单击该区域右上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.40115634357779875323860488347729:50001231000000:2800:A933350E22580EF0259D06B8EE7ADC28E528B7D4452773C9696719D4AD9519F3.png)，点击添加面包屑。添加面包屑后，该节点成为根节点，耗时占比为100%，子节点的耗时占比相对于该节点重新计算。
        - 在火焰图中选中任一节点，使用“Alt+鼠标左键”可将该节点左置底并将其占比放大到100%，其上从属节点按同比例放大显示。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.87069465907808464742394915438474:50001231000000:2800:0E601C8BC42FF4497CB6B4F0213415777761295E7F97BEE1D490B088765C9627.png "点击放大")
        
    - 在“ArkTS Callstack”子泳道或“Callstack”子泳道上点击**Unfold CallStack**按钮，可以在时间轴上将函数调用栈以冰锥图的形式展示。其中调用栈的先后顺序与实际调用时序保持一致。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.69858774514452401942890465540754:50001231000000:2800:128DC27A094A1D0280BBBF39044F400BCFF8702139EB5A264C30B47519F0F419.png "点击放大")
        
    
4. 在**Callstack**泳道上长按鼠标左键并拖拽，框选要分析的时间段。
    
    - **Summary**列表展示框选时段内，所有Native线程的CPU占用率的峰值、谷值、平均值。
    - **Callstack**列表展示框选时段内，所有Native线程的函数热点。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.91808847113753772125419087621660:50001231000000:2800:ECBF7CE36085D6AAA65D3794981DAB8BC2CDAA1F9713648EB5F87F401C5860D6.png "点击放大")
    
    - 悬浮到节点，显示以此节点为根按钮，点击添加面包屑。添加面包屑后，该节点成为根节点，耗时占比为100%，子节点的耗时占比相对于该节点重新计算。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.78237316670579940149339296675409:50001231000000:2800:819B126A6A3EF24F80590DC9490EFBB7ACA640A6FA19237EF89766B4832AB084.png "点击放大")
    
5. 在**Callstack**子泳道上长按鼠标左键并拖拽，框选要展示分析的时间段。
    
    - **Top Down**页签显示所选时间段内的函数栈耗时分布情况，**Heaviest Stack**区域会展示出“Details”区域选择节点所处的耗时最长的完整调用栈。
    - **Bottom UP**页签显示函数列表，展开任一函数节点可查看其调用方及每个调用方的耗时。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155929.17183241503744117655335652006553:50001231000000:2800:EDE8405FB78C9EB38203DB949DAE4039F6C663AB897689798255CF613F41D48A.png "点击放大")
    
6. （可选）在**Details**中双击需要优化的节点（例如耗时超过预期），可快速跳转至对应工程源码，为开发者节省定位代码路径的时间。
    
    说明
    
    - Release应用暂不支持跳转到用户侧Native代码。
    - 静态链接的系统库无法支持源码跳转。如libunwind.a，在编译过程中该系统库会以静态链接的方式集成。该系统库的符号信息在调用栈中会被识别成用户侧定义的函数，实际上无法跳转到源码。
    

## 多实例函数热点分析

在应用开发过程中，可能存在一些耗时操作，则需要引入Worker线程或者TaskPool任务池来协同处理。这些线程也可能会像主线程一样存在性能问题，所以需要同时对这些子线程进行性能调优。其中，主线程以及每一个Work线程或者TaskPool工作线程，都会对应一个方舟实例，通过连接这些方舟实例，开启性能采样，从而可以获取更全面的采样信息。

- 父泳道内可以看到被选择进程的CPU使用率，框选后展示此时段内录制到的所有方舟实例的函数调用栈信息。
- 子泳道框选后展示此时段内录制到的该方舟实例的函数调用栈信息。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.21376469531053819903069858129328:50001231000000:2800:BFED84BA33B01FB5DD8B74D6FBE1CB53923EDD60A13AAF6CC27B1CD9462DBF14.png "点击放大")

## 离线符号解析

DevEco Profiler提供离线符号解析能力，基于携带符号表信息的so库进行分析，可把符号地址解析为具体函数名称，便于定位函数位置。

对于有so库路径和偏移地址的采样数据，如图所示，通过导入对应的携带符号表信息的so库进行解析，补充release so库中缺失的符号表信息（包括系统so库，用户自编译的so库，三方库）。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.65811944892397217207185288711440:50001231000000:2800:CADA31EFFEB60C15AB17BB680C71C6269A617EB0409846D5C1770955BC0C18D5.png "点击放大")

您可以通过点击工具栏![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.00113816390041376450850984501239:50001231000000:2800:7C370FE578242F1A810880E872EF9EAB27FC48F2061DCA44A0B86FC3F1628A16.png)按钮，导入包含debug信息的so库。

说明

- 离线导入携带符号表信息的so库，需要严格保证与release版本的so库保持同一优化等级（如-O1, -O2, -O3等）。可以在CMakeLists.txt文件中查看或配置编译优化等级。
- 离线导入携带符号表信息的so库，需要尽可能与release版本的so库编译选项保持一致，防止so库起始地址不一致，影响解析正确性。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.45901630287371785941941414540967:50001231000000:2800:F47F480D12179092C79E21ACC6F00B63851FA65184230AB865710AF07AB4BE76.png "点击放大")

## 查询自定义打点信息

相较于异步调度，DevEco Profiler当前基于采样分析的Time任务更善于分析同步性能问题。如开发者需要分析异步调度延时等问题，可先在ArkTS代码中进行自定义打点，当应用/元服务在Time分析过程中触发打点后，DevEco Profiler会将这些打点的Trace数据解析后，以任务方块形式呈现在“User Trace”泳道中。

您可以在“User Trace”子泳道上长按鼠标左键并拖拽，框选要展示分析的时间段，获取该时间段内的用户打点信息。

单击User Trace泳道的“options”下拉列表，可以设置是按照Task Name维度还是Thread ID维度显示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.61610136178995231668087528745632:50001231000000:2800:65D8D5CB1C64733D215BB15C358E49DF23E6D8D1D39B04289850512B8202783D.png)

- Statistics页签：显示当前任务泳道在所选时间段内的打点任务统计信息，包括任务的名称、同一任务执行的次数、平均持续时长、最长持续时间和最短持续时间。通过这些统计信息，开发者可直观地了解打点任务的执行频率、持续时间偏差等，方便定位。
- User Trace页签：将所选时间段内的所有任务都一一列举出来，包括任务的ID、名称、起始/结束时间、持续时长等。

同时，您也可以单击“User Trace”子泳道中的任意一个任务块，“Details”区域将展示该任务块的详细信息。

说明

此外，用户自定义打点信息，还可以在Frame分析、Network分析任务中查看到。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155930.90090046933263812119927859631973:50001231000000:2800:0E6D6B18D72D166A320FC341284E73BC945418CD0864F7D47EE50EE289071E79.png "点击放大")

[  
](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording "性能问题定位：深度录制")
# 内存分析介绍

更新时间: 2025-12-16 15:59

应用在开发过程中，可能会因为API使用错误、变量未及时释放、异常频繁创建/释放内存等情况引发各种内存问题。

DevEco Profiler提供了基础的内存场景分析Allocation，您可以使用Allocation来分析应用或元服务在运行时的内存分配及使用情况，识别和定位内存泄漏、内存抖动以及内存溢出等问题，对应用或元服务的内存使用进行优化。

在设备连接完成后，可按照如下方法查看内存分析结果：

1. 构建应用前请参考[模块级build-profile.json5文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile)，增加strip字段并赋值为false（strip：是否移除当前模块.so文件中的符号表、调试信息，配置为false代表不移除）。采集函数栈解析符号需要附带符号表信息，无符号表信息可能采集不到函数名称，因此请按照下图进行配置。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155933.15818632277241292539394212113451:50001231000000:2800:5ED5EB3FBB2DE54A1AFD91DDD82A71B2EF8A6D09BF7EDD37A9DE6A9CE950DC74.png "点击放大")
    
2. 创建Allocation分析任务并录制相关数据，操作方法可参考[性能问题定位：深度录制](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording)，或在会话区选择**Open File**，导入历史数据。
    
    Allocation分析任务支持录制**Memory泳道**、**ArkTS Allocation泳道**、**Native Allocation泳道**，在录制前单击![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.69475075774539570093878890209606:50001231000000:2800:F9DB94D71107BADEABFF9BEDA426357EC4C98D8ECC0E6AF678B9341D1EE5FBCD.png)指定要录制的泳道。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.44098986549826754421659754114734:50001231000000:2800:FC98310890CD9FFD8BAB5C5598F74F40556746F4A97E16420CA0851FD9974BD1.png "点击放大")
    
    说明
    
    - 在任务分析窗口，可以通过“Ctrl+鼠标滚轮”缩放时间轴，通过“Shift+鼠标滚轮”左右移动时间轴。或使用快捷键W/S放大或缩小时间轴，使用A键/D键可以左右移动时间轴。
    - 将鼠标悬停在泳道任意位置，可以通过M键添加单点时间标签。
    - 鼠标框选要关注的时间段，可以通过“Shift+M”添加时间段时间标签。
    - 在任务分析窗口，可以通过“Ctrl+, ”向前选中单点时间标签，通过“Ctrl+. ”向后选中单点时间标签。
    - 在任务分析窗口，可以通过“Ctrl+[ ”向前选中时间段时间标签，通过“Ctrl+]”向后选中时间段时间标签。
    - Allocation分析支持离线符号解析能力，请参见[离线符号解析](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-time#section186881175012)。
    - 在任务录制过程中，单击分析窗口左上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.70936254815592098871001853974107:50001231000000:2800:0522ADD66D29BBC5BA7550C885C910CC06FD217AD6A2E3E810E1D8E64B9CEF99.png)可启动内存回收机制。
    - 当方舟虚拟机的调优对象的某个程序/进程占用的部分内存空间在后续的操作中不再被该对象访问时，内存回收机制会自动将这部分空间归还给系统，降低程序错误概率，减少不必要的内存损耗。
    
    - Memory泳道：显示当前进程的物理内存使用情况，其度量方式包含：
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.41794971276361993382750408891772:50001231000000:2800:81A938EE1DD683CA5521B7869525C4A1D9B299708DDD8FD0A558F0B03BF636BB.png) PSS：进程独占内存和按比例分配共享库占用内存之和。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.25491688548587369400588330544275:50001231000000:2800:91AB5326724181CDA7C7F3EEAAB375AAE774F70DEC0E9EED116AB13806F5F3FD.png) RSS：进程独占内存和相关共享库占用内存之和。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.85230177199776323768731498133374:50001231000000:2800:3675018AD9F94578005963480C4243F9F6E70A60379C1E73121CDEE3342E8DC2.png) USS：进程独占内存。
        
        默认只显示PSS的统计图，如需要查看USS或RSS，需要在Memory泳道的右上角点选相关数据类型。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.39223831547380628605661458732382:50001231000000:2800:A5133CC88019F2462001813FB17DE4F3B31F868AE79C7F7233A08944415EB788.png)
        
        展开Memory泳道，子泳道展示的是按照内存类型将进程PSS值拆分开的各个维度的内存信息，类型包含ArkTS Heap/Native Heap/GL/Graph/Guard/AnonPage Other/FilePage Other/Dev/Stack/.hap/.so/.ttf。默认展示其中的五个子泳道，如要显示其他子泳道，可以点击主泳道的options标签并勾选其他泳道来查看。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.72219212370460845265990526406105:50001231000000:2800:85C8BD99CA830DFA6B4A419A04A9475D78DC8A9F5C5563495D916DED95D8CBB7.png "点击放大")
        
        - ArkTS Heap：ArkTS堆的内存占用。
        - Native Heap：Native层（主要是应用依赖的so库的C/C++代码）使用new/malloc分配的堆内存。
        - GL：应用：纹理内存，RS：纹理+图形渲染内存。
        - Graph：该进程按去重规则统计的dma内存占用，包括直接通过接口申请的dma buffer和通过allocator_host申请的dma buffer。
        - Guard：保护段所占内存。
        - AnonPage Other：其他所有匿名页所占内存（非heap、anon:native_heap、anon:ArkTS heap开头的匿名页）。
        - FilePage Other：其它映射到文件页但不能被归类到.so/.db/.ttf类型的内存占用。
        - Dev：进程加载的以/dev开头的文件所占内存。
        - Stack：栈内存。
        - .hap：进程加载的.hap文件所占内存
        - .so：进程加载的.so动态库所占内存。
        - .ttf：进程加载的.ttf字体文件所占内存。
    - ArkTS Allocation泳道：显示方舟虚拟机上的内存分配信息。该泳道默认不展示，如需录制该泳道数据，在录制前单击左上角菜单栏![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.26749875344847036813838256156676:50001231000000:2800:DE3F36BD8614A8B3896C961F1D3EFCFEDFF998B0BBFBAA4E8AC0B7314CB69B44.png)图标，勾选ArkTS Allocation泳道。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。该泳道即将下线，推荐使用Snapshot模板分析ArkTS内存泄漏。
        
        说明
        
        由于较大的性能开销可能导致卡顿/卡死问题，暂不支持同时录制ArkTS Allocation和Native Allocation两条泳道。
        
    - Native Allocation泳道：显示具体的Native内存分配情况，包括静态统计数据、分配栈、每层函数栈消耗的Native内存等信息。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。
        
        单击工具控制栏中的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.43729107589572598402006049573470:50001231000000:2800:83C50673A3FD0C56F8C0F189B124A8CE67B432EA3532D8E0411CBD36B1507FB7.png)按钮，可以设置是否为统计模式、统计间隔、最小跟踪内存、回栈模式、JS回栈、JS回栈深度和Native回栈深度。
        
        - Statistics Mode：该项配置代表是否开启统计模式采集数据，默认开启。开启后，数据会每隔Sampling Interval中设置的时间从设备端汇总并返回。
        - Sampling Interval：统计时间间隔。仅在统计模式下需要设置，可设置范围为1s~3600s，默认为10s。
        - Filter Size：最小跟踪内存。该参数表示最小抓取的内存大小。可配置范围为0-65535Bytes，默认为1024Bytes。
        - Backtrace Mode：内存分配栈回栈模式。当前提供FP和DWARF两种回栈模式。FP回栈是通过帧指针（FP寄存器）链接栈帧，直接遍历调用链。DWARF回栈是基于编译器生成的DWARF调试信息进行栈回溯。默认FP回栈。FP回栈性能更好，但在某些特定场景下（例如so的编译参数控制），FP回栈可能失效，此时可选择DWARF回栈尝试。
        - Record JS Stack：是否开启JS回栈。当该开关打开时，系统回栈时会自动从Native向JS层回栈，完成Native到JS的栈缝合，适合ArkTS/JS代码调用Native的场景。
        - JS Backtrace Depth：JS回栈深度。可配置范围为1-128，默认10层。
        - Native Backtrace Depth：Native回栈深度。可配置范围为5-100，默认10层。
        - Backtrace Stack：回栈深度。仅当Backtrace Mode选择为DWARF模式的情况下存在，其层数代表着JS与Native的共同回栈深度。可配置范围为5-100，默认20层。
            
            说明
            
            - 设置的最小跟踪内存数值越小、回栈深度越大，可能会导致DevEco Profiler卡顿。请根据应用实际的调测情况进行合理设置。
            - 统计模式用于不关注单次分配、关注应用较长时间的内存变化情况的场景，将指定的采样间隔内的数据做合并统计，以达到降低处理数据量，提高录制效率和时长的目的。设置的Sampling Interval为近似值，即尽可能地在接近这个时间内做统计汇总，存在一定的偏差，偏差不超过1s，偏差不会对内存分配的正确性产生影响。
            
            ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.65786828506353907007754934274602:50001231000000:2800:36B36324A2376BB9648341FD25C536C94C012C51E14036FB54F54C29246D3540.png "点击放大")
            
    
3. 在目标泳道上长按鼠标左键并拖拽，框选要展示分析的时间段。Details区域中显示此时间段内指定类型的内存分析统计信息：
    
    - Memory泳道：
        - 主泳道的详情区域显示当前框选时间段内各采样点的应用内存PSS总和，以及各种内存页面状态的内存占用总和。
            
            ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.64670728736083294468404300343794:50001231000000:2800:8B4F1C0299AD1065C0C14E9A5C6217CB3AAFAE27F2DE18E5E4FD665557059449.png "点击放大")
            
        - 子泳道的详情区域显示该泳道所代表的内存类型的框选时间段内各采样点的PSS总和以及各种内存页面状态的实际占用情况。
            
            注意
            
            Graph字段统计方式为：计算/proc/process_dmabuf_info节点下该进程使用的内存大小。
            
            ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.80536961991777108954923862196117:50001231000000:2800:60004AE670D390AC2850C0D2EC9975F64ADD9494A4608AAB3E00FAF7BB5FEC87.png "点击放大")
            
    - ArkTS Allocation泳道：显示被选择进程所使用的所有ArkTS内存总和，框选后展示此时段内录制到的所有方舟实例的对象分配信息。框选子泳道后显示当前框选时段内运行对象的内存使用情况，包括层级、对象自身内存大小、对象关联内存大小等。该泳道即将下线，推荐使用Snapshot模板分析ArkTS内存泄漏。
        
        “Details”区域中带![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.24580035581945568065781490119014:50001231000000:2800:8EF7C558166F33583A4EDAE7042CDDD267DAC114D85E6E7CCF0E1C5C2D8DC7EB.png)标识的对象，表示其可以通过窗口访问。每个时段内已释放的内存大小在柱子上置灰，未释放的内存保持绿色。
        
        ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155934.09818252450151563248401899584457:50001231000000:2800:FABBD8265C6B291B0188CD93BB8D211162D9729E8950C4C48D6065DD135AB2C2.png "点击放大")
        
    - Native Allocation泳道：框选子泳道后显示具体的内存分配，包括静态统计数据、分配栈等。
        - Statistics页签中显示该段时间内的静态分配情况，包括分配方式（Malloc或Mmap）、总分配内存大小、总分配次数、尚未释放的内存大小、尚未释放次数、已释放的内存大小、已释放次数。
            
            点击任意对象上的跳转按钮，可跳转至此类对象的详细占用/分配信息。当前统计模式下不支持跳转。
            
        - Call Trees页签显示线程的内存分配栈情况，包括函数地址或符号、分配大小、占比以及函数栈帧的类别等。单击任一行栈帧，“More”区域将显示经过该栈帧的分配内存最大的调用栈。
        - Allocations List显示内存分配的详细信息，包括内存块起始地址、时间戳、当前活动状态、大小、调用的库、调用库的具体函数、事件类型（与Statistics页签的分配方式对应）等。
            
            说明
            
            统计模式（Statistics Mode）开启后，不存在Allocations List信息。
            
            选择任一对象，右侧会展示与该对象相关的所有库和调用者。
            
            ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.99600880340890604117730674352177:50001231000000:2800:134599C27BCC2CDF18D0B9ABEA0CA09397F308948BF1C315934D43B5A2F68BB1.png "点击放大")
            
    
4. （可选）根据分析结果，双击可能存在问题的调用栈，跳转至相关代码。开发者可根据实际需要进行优化。
    
    说明
    
    Release应用暂不支持跳转到用户侧Native代码。
    # 内存分析数据筛选

更新时间: 2025-12-16 15:59

Allocation分析过程中提供多种数据筛选方式，方便开发者缩小分析范围，更精确地定位问题所在。

## 通过内存状态筛选

在Allocation分析过程中，对“Native Allocation”泳道的内存状态信息进行过滤，便于开发者定位内存问题。

在“Native Allocation”泳道的“Detail”区域左下方的下拉框中，可以选择过滤内存状态：

- All Allocations：详情区域展示当前框选时间段内的所有内存分配信息。
- Created & Existing：详情区域展示当前框选时间段内分配未释放的内存。
- Created & Released：详情区域展示当前框选时间段内分配已释放的内存。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.45556602318333221804712856207249:50001231000000:2800:7A68C23A7ED1CF50A0B7D5A2A535CD97DC5E2E7DA0835828802E31587F429BD3.png "点击放大")

## 通过统计方式筛选

在“Native Allocation”泳道的“Statistics”页签中，可以打开“Native Size”选择统计方式以过滤统计数据：

- Native Size：详情区域按照对象的内存进行展示。
- Native Library：详情区域按照对象的so库进行展示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.49908315129229347199817413629436:50001231000000:2800:0D74CBFEC01795D10422BB684899DC45A5E8985E6A156837BCA0F82455DF64CB.png "点击放大")

## 通过so库名筛选

非统计模式下，在“Native Allocation”泳道的“Allocations List”页签中，可以单击“Click to choose”选择要筛选的so库以过滤出与目标so库相关的数据：

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.96330602099165662408829593842276:50001231000000:2800:1ABDE5CC7794DEF19B95F296AC4A9292FBB053239A58CB443516C4FD585084CF.png "点击放大")

## 通过搜索筛选

在**Native Allocation**泳道的页签中， 根据界面提示信息输入需要搜索的项目，可定位到相关内容位置，使用搜索框的<、>按键可依次显示搜索结果的详细内容。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.53350107978092847860849091605754:50001231000000:2800:DDD933792CC41FDE0770708D2E6D4DBC0B7110166AB703ACD8160BD9D8C90677.png "点击放大")

## 筛选内存分配堆栈

在Native Allocation泳道的Call Trees页签中，可以通过底部的“Call Trees”和“Constraints”选择框来筛选和过滤内存分配栈。

Call Trees选择框包含两种过滤条件：

- Separate by Allocated Size：在内存分配栈完全相同的情况下，会按照每次分配栈申请的内存大小将栈分开；
- Hide System Libraries：隐藏内存分配栈中的系统堆栈。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.98662924047613000448178284732798:50001231000000:2800:FE2F4AA595FC615C4F61BCB6BEB7013506B9F6DF652494F25AD64F1CAFCD1C63.png "点击放大")

Constraints选择框也包含了两种过滤条件：

- Count：根据指定的内存申请次数过滤内存分配栈信息；
- Bytes：根据指定的内存申请大小过滤内存分配栈信息。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.15538767955646346619589563749114:50001231000000:2800:76429E33F53E8618D2BD3BCF17C3D7CE472C37FCCF8EA0B72FC9F10B855AB312.png "点击放大")

在Call Trees页签的More区域，单击“Heaviest Stack”旁的隐藏按钮可以单独控制是否显示More区域最大内存分配栈中的系统堆栈。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.52598869785064769699158684591547:50001231000000:2800:E5B614E6353BDE8DF3DC68BFE5DC745EE099D4608F6B498583DA5F413F8E3016.png "点击放大")

在Call Trees页签，可以通过底部的“Flame Chart”切换到火焰图视图。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155942.05156477370634349798604189099934:50001231000000:2800:4BBB44B97E0E4554DE207F13F2F73A635B443CCC320A92D12B95A5B88A9342E6.png "点击放大")
# 启动时内存分析

更新时间: 2025-12-16 15:59

应用/元服务在启动过程中对内存资源的占用情况，是开发者较为关心的问题。DevEco Profiler的Allocation分析任务，提供了启动内存分析能力，协助开发者优化启动过程的内存占用。

针对调测应用的当前运行情况，DevEco Profiler对其做如下处理：

- 如选择的是已安装但未启动的应用，在启动该分析任务时，会自动拉起应用，进行数据录制，结束录制后可正常进入解析阶段。
- 如选择的是正在运行的应用，在启动该分析任务时，会先将应用停止，再自动拉起应用，进行数据录制，结束录制后可正常进入解析阶段。

具体操作方法为：在任务列表中单击Allocation任务后的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155948.45898585896760305235214363268574:50001231000000:2800:9A75623E99CAFC55013767948FA09F417F8211913995FF59A43CEF234600715F.png)按钮。

在分析结束后，呈现出的数据类型以及相应的处理方法，与非启动过程的分析相同，请参考[内存分析介绍](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-allocations-memory)、[内存分析数据筛选](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-allocations-data-filtering)。
# 案例：Native内存泄漏分析

更新时间: 2025-12-16 15:59

本案例介绍如何判断应用存在Native内存泄漏，以及如何通过Native Allocation泳道找出Native内存泄漏的原因。

## 初步识别内存问题

1. 使用实时监控功能（详细使用方法请参考[性能问题定界：实时监控](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/realtime-monitor)）对应用的内存资源进行监控。正常操作应用，观察运行过程中的应用内存变化情况。当在一段时间内， 应用内存没有明显增加或者在内存上涨后又逐渐回落至正常水平，则基本可以排除应用存在内存问题；反之，在一段时间内不断上涨，且无回落或者内存占用明显增长超出预期，那么则可初步判断应用可能存在内存问题。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.52101885217763272486583534863134:50001231000000:2800:26A1228F1D77626469EDEF3B61CBFEFC9D2447FEC24B1E1F306B4159E9F83210.png "点击放大")
    
2. 当从实时监控页面初步判断应用可能存在内存问题后，可以使用Memory泳道来抓取应用内存的详细数据以及变化趋势，初步定界问题出现的位置。Allocation或Snapshot模板中均有Memory泳道，使用Allocation或Snapshot模板录制均可。
3. 创建模板后，将模板中的其余泳道去除勾选，仅录制Memory泳道的数据。
    
    说明
    
    其余泳道会开启对内存分配、内存对象等数据的抓取，这些功能会带来额外的开销，可能会对我们初步定界问题产生影响，建议先排除录制。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.37918780848869706440463585698737:50001231000000:2800:46FA6062A99DD7B46E043D0558DCA202F3D260FDB5832E3B1252694592FAC493.png)
    
4. 点击三角按钮![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.11829826973914280015031548283368:50001231000000:2800:BAA86CBE7565281971EF6D498239AA6124D048088C506A0D1EA9E61AB72CA527.png)即开始录制。
5. 录制过程中，不断在问题场景操作应用功能，放大问题便于快速定界问题点。
6. 点击下图中方块按钮或者左侧停止按钮结束录制。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.97986326066662030461397549640933:50001231000000:2800:F27E8D122B405A1650EA1CBEDD6C9E44F4CF83CDBD8495400E6211B38EF98EC2.png "点击放大")
    
7. 录制完成后，展开Memory泳道，其中ArkTS Heap表示方舟虚拟机内存，这部分内存受到方舟虚拟机的管控。Native Heap表示Native内存，主要是应用使用到的一些涉及Native API所申请的内存以及开发者自己的Native代码所申请使用的堆内存（通常是C/C++），这部分内存需要开发者自行管理申请和释放。
    
    当ArkTS Heap有明显的上涨，说明在方舟虚拟机内的堆内存上可能存在内存泄漏，可以使用[Snapshot模板](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-snapshot-basic-operations)进行下一步分析；当Native Heap有明显的上涨，说明Native内存上可能存在内存泄漏，可以使用[Allocation模板](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-native-allocation-case#section776643810160)进行下一步分析。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.35071533187914140350890079367574:50001231000000:2800:8E8C5A6720A0F9F7A40DF678D1990F35C6A366A4C32FE7D4298538DDA1FE6A2F.png "点击放大")
    

## 使用Allocation模板分析Native内存问题

### 录制Allocation模板数据

1. 连接设备后，点击应用选择框选择需要录制的应用，选择**Allocation**模板，点击Create Session或双击Allocation图标即可创建一个Allocation的录制模板。
2. 创建模板后，点击三角按钮即开始录制。
    
    说明
    
    如果要分析启动内存，单击Allocation任务后的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.06142966192787307528659597626493:50001231000000:2800:DB708D246317EDA90E0B580C6F47095EB6AE511058F7AC83096C22E842BB529C.png)按钮。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.73477788866148659770601988209487:50001231000000:2800:CF311A96D3F339436C81BF1574C3E8BDFF309FB56C8BF66F6BCF4EB848DF3775.png "点击放大")
    
3. 操作应用复现问题场景，并在问题复现完成后，点击下图中方块按钮或者左侧停止按钮结束录制。
    
    说明
    
    - 默认使用统计模式采集数据。该模式下工具的采集性能更好、负载更低。
    - 使用统计模式时，录制的结束时间需要是Sampling Interval即采样周期的整数倍，例如当采样周期是10s时，停止录制时间建议在11s+/21s+，以此类推，留出余量给系统做数据处理与传输。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155949.47301077353129170964141594447378:50001231000000:2800:8C4DAAE156A2CEC0E90AEB6172E378024AAD455527F7131BCA8E29B1434954F5.png "点击放大")
    

### 分析Native数据

1. 框选Native Allocation泳道或子泳道。两个子泳道All Heap和All Anonymous VM分别代表使用malloc和mmap函数分配的内存情况。

2. 在下方详情区的“Statistics”页签中选择Created & Existing。
    
    - All Allocations：框选的时间段的所有分配内存信息。
    - Created & Existing：在框选范围的起点之后分配的，且在框选范围的终点之前没有释放的内存数据。
    - Created & Released：在框选范围的起点之后分配的，且在框选范围的终点之前已经释放的内存数据。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155950.82006922757029698335009130315190:50001231000000:2800:479A8A7501BFAC55F6B5AD0A95B330478335BFD39AE710EBDC559E6D9BF9CEFC.png "点击放大")
    
3. 切换到“Call Trees”页签，该部分数据展示了详细的内存分配栈信息，同样需要选择Created & Existing。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155950.77883604667484815652347640179330:50001231000000:2800:D2D3809791C9CE9EA20ED06E66FE2838C0BC76DC7C030AE80F712C53CC748F76.png "点击放大")
    
4. 优先在内存分配栈信息中寻找与业务代码强相关的Symbol Name，即Category中为亮色。从上图中看，主要泄漏点在业务代码侧，需要结合业务代码进行分析。
    
    说明
    
    - Category中亮色代表开发者调用栈，灰色代表系统调用栈。
    - 栈帧中主要为 Native 栈，除了应用本身编译的一些so及带有部分接口信息的so信息外，其他系统库部分仅展示so库与函数偏移信息，若需要查看这部分信息，需要导入相应版本的带符号的 so 库（具体参考[离线符号解析](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-data#section11376118192614)）。
    # 使用Snapshot模板基本操作

更新时间: 2025-12-16 15:59

## 查看快照详情

1. 创建Snapshot场景调优分析任务，操作方法可参考[性能问题定位：深度录制](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording)。
    
    说明
    
    - 在任务分析窗口，可以通过“Ctrl+鼠标滚轮”缩放时间轴，通过“Shift+鼠标滚轮”左右移动时间轴。或使用快捷键W/S放大或缩小时间轴，使用A键/D键可以左右移动时间轴。
    - 将鼠标悬停在泳道任意位置，可以通过M键添加单点时间标签。
    - 鼠标框选要关注的时间段，可以通过“Shift+M”添加时间段时间标签。
    - 在任务分析窗口，可以通过“Ctrl+, ”向前选中单点时间标签，通过“Ctrl+. ”向后选中单点时间标签。
    - 在任务分析窗口，可以通过“Ctrl+[ ”向前选中时间段时间标签，通过“Ctrl+]”向后选中时间段时间标签。
    
2. 设置Snapshot泳道。
    
    单击任务左上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.49056428107481105560231116883124:50001231000000:2800:E51B3B221FBFF1C00468C9516F7A620D012B8A3D06C1EADC9AD11B7EF04320D8.png)进行泳道的筛选，再次单击此按钮可关闭设置并生效。
    
3. 单击ArkTS Snapshot泳道的“options”下拉列表，可以设置是否需要抓取基础类型number的数据。默认不抓取。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.86836891073175294285384591746694:50001231000000:2800:B1CC76010A9B39AFC36A2FEF90FE10F0CAB8EA13131A0FD8A5A8ED5FF2CF5BBA.png)
    
4. 开始录制后可观察Memory泳道的内存使用情况，在需要定位的时刻单击任务左上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.90103441503588346649176864994124:50001231000000:2800:38153B47915376A5697C515FCAD8F21EE24461FCD7C9B15C12A28325E74A7229.png)启动一次快照。
    
    “ArkTS Snapshot”泳道的紫色区块表示一次快照完成。
    
    说明
    
    - 在任务录制过程中，单击分析窗口左上角的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.04141080931989027271728621618383:50001231000000:2800:9ABC6FCA58D01B700270827E2752C29E9930583A5EE05D7BF6BD7F755ACC8D30.png)可启动内存回收机制。
    - 当方舟虚拟机的调优对象的某个程序/进程占用的部分内存空间在后续的操作中不再被该对象访问时，内存回收机制会自动将这部分空间归还给系统，降低程序错误概率，减少不必要的内存损耗。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.20160969051457725852369875852598:50001231000000:2800:71F4B5472DE7D48C5F44A05039C35622EE863685D14983FAAF553D54E00BD23D.png "点击放大")
    
    在“Statistics”页签中显示当前快照的详细信息：
    
    - Constructor：构造器。
    - Count：该对象的数量。
    - Distance：从GC Root到这个对象的距离。
    - Shallow Size：该对象的实际大小。
    - Retained Size：当前对象释放时，总共可以释放的内存大小。
    - Native Size：该对象所引用的Native内存大小。
    - Retained Native Size：当前对象释放时，总共可以释放的Native内存大小。
    - 带![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.24516147380735066616557379006348:50001231000000:2800:DD072C3C97D55FFB5FDC2AB13E2BCAC1E0FDA2BB1478AD9B6403DED21729292E.png)标识的对象，表示其为全局对象，可以通过全局window对象直接访问。
    
    ![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.13099071772898534405356427343246:50001231000000:2800:148944D00095866962AB4BF8B9563AE4518968A1439F3044EF1F4E0E900BD29E.png "点击放大")
    

## 应用对象名称解析

方舟系统目前有方舟应用对象、系统内部框架对象、其他JS对象三类对象，从DevEco Studio 6.0.0 Beta1版本开始，支持对应用对象类的名称进行解析，帮助开发者快速定位问题所在的源码位置，从而提升问题定位效率。

1. 系统内部框架对象：用于描述HarmonyOS操作系统底层框架的核心对象，提供基础系统能力。为方便开发者查看，当前在Statistics中此类对象均归类到（framework）构造器节点下。此类对象均以_GLOBAL开头。
2. 方舟应用对象：用于表示HarmonyOS应用中的具体组件、模块或资源。方舟应用对象需按照以下格式命名展示：
    
    1. com.example.app/MainModule@1.0.0/src/main/ets/MainPage.ets#MainPage(line: 10)[MainModule] //格式为BundleName/SelfModule@Version/FilePath/File#Class(line: xx)[RefModule]
    
3. 其他JS对象：用于描述方舟运行时中与JavaScript引擎相关的对象，提供JS语言层面的基础能力。例如：JSArray、JSSharedObject等。

在 Snapshot分析模板中，支持在Attributes页签点击方舟应用对象名称查看当前所选方舟应用对象的解析结果，便于确认问题出现的位置。各参数含义如下：

- Module：模块信息。
- Class：属性名称。
- Path：编译后的源码路径。支持通过点击属性名称旁边的![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.65594525584151967187404659141366:50001231000000:2800:E07D22251BFE430C36683AE839427FBF2CD189AA117AA9A9C64ED8F225DBEAFC.png)图标直接跳转至工程中的代码位置，方便开发者快速调试。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.32464292829942772208927431837234:50001231000000:2800:48AED01A74F81E4F9455A6B3096BDE40C5F9511775903226E3911418F8C1756F.png "点击放大")

说明

- 确保工程代码路径与解析信息匹配，否则跳转可能失败。
- 系统内部框架对象（framework）仅提供基本信息，不支持跳转。
- 对象名称后的line=0时表示无效行号，不支持跳转。

## 节点属性与引用链

在“Snapshot”的“Statistics”页签和“Comparison”页签中，所有实例对象节点展开后会显示"<fields>"以及"<references>"，这两项节点分别代表该实例对象的属性以及该实例对象的引用链信息。

在“Snapshot”的More区域则展示“Fields”和“References”两个页签，分别代表Detail区域所选择对象的属性以及引用链信息，方便快捷查看所选中对象的属性等详细信息，而不需要跳转至对应对象。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.73376610212324258098948420800510:50001231000000:2800:F6E246AC4148EB813E7F51F0508E8F829D7E5C8469614FC7B0F92C884F3DC383.png "点击放大")

## 节点跳转

在“Snapshot”的“Comparison”页签中，查看内存对象、对象属性及其引用链时，若要查看某一对象的详细信息，可以单击该对象所在行行尾的跳转图标跳转至该对象所在的“Statistics”页签并定位至该对象所在的位置，以查看该对象的详细信息。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155935.52589699178591145437036962513327:50001231000000:2800:6282F20F00A3192C4123863B0233F3A492074F87F93DD257A47492F9CC4D6E86.png "点击放大")

## 历史节点前进/后退

当在“Comparison”和“Statistics”之间进行节点跳转后，单击详情区域左下角的左右箭头可以前进或者后退至下一个或上一个历史节点，以便快速在多个历史节点之间跳转查看。当箭头为激活状态时，表示前进/后退功能可用，当箭头为灰色状态时则代表无法使用该功能。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.24714125152495610414202138298090:50001231000000:2800:43E8C60DF2572AEFB8C6C80D3E273143075F23283B9ABE94E4C910537A39FD2E.png "点击放大")

## 比较快照差异

在“Snapshot”的“Comparison”页签中，以当前选择的快照为base，下拉框选择的快照为Target，即可得到两次快照信息的比较结果。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.62598142624612862081125420104285:50001231000000:2800:E85A37A8348F7F94951869176C6D314E429B24B0795699BDCF513651EEBBB84D.png "点击放大")

在“Snapshot”的“Comparison”页签中，可进行两次快照的差异比较，比较内容包括新增数、删除数、个数增量、分配大小、释放大小、大小增量等等。通过不断对比，可快速分析和定位内存问题的具体位置。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.89104438026741831690396535491732:50001231000000:2800:9DE43E3E1B546077B74954FCF028475073E39E5460CD48B60D276297A744CA46.png "点击放大")

## 引用链向最小引用距离展开

Snapshot分析支持一键向引用链最小的引用距离方向展开。系统会计算从GC Roots垃圾收集器根到选定实例对象的最短路径（最短路径是指Distance逐渐-1的路径，最终抵达Distance = 1的节点），通过最短路径，能够清晰地看到该对象的句柄被哪些对象持有，快速定位问题产生的根源。

选择一个实例节点，底部搜索栏的Path to GC Root按钮呈可点击状态。点击该按钮选择搜索模式并确认，系统会计算从GC Roots到选定对象的最短路径，并在右侧区域展示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.25931918843012389037853634065963:50001231000000:2800:257CE81F02343EA6E35E22257D49F0D0C8032DDB3CFE18A2A61F9CD9A1DE72B0.png "点击放大")

目前支持单根路径搜索、指定数量的根路径搜索和展示所有根路径三种搜索模式，默认为单根搜索。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.15300525675765096447575409053909:50001231000000:2800:706CE54B91FBB445C8237066A7CB9B79FADC5A367375E3072EB6451C61BF4188.png "点击放大")

设置完搜索模式后点击OK，右侧more区域会自动跳转至Shortest Paths页面展示搜索结果。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.66363759860968671844668750796270:50001231000000:2800:8C85AEFC1809FB71EA2F442D7580FD1F6ECAC30291DB94024902321D4F1915A8.png "点击放大")

## 引用链可视化

从DevEco Studio 6.0.0 Beta1版本开始，Snapshot模板支持将所有引用链以图表形式展示。系统会计算该节点周边的引用节点，并以关系图的形式清晰展示该对象的引用关系，便于定位问题产生的根源。

选择一个实例结点或reference引用关系节点后，底部搜索栏的**Visualization**按钮呈可点击状态。点击该按钮，配置搜索模式后，系统会计算该节点周边的引用节点，并跳转到Graph页签进行展示。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.08705458922509548462533435579955:50001231000000:2800:BA2AB3CA15B35BD4367E35A9DED091B5540C8570664E3301506BAF2B49A86569.png "点击放大")

目前支持最多展示30个周边节点，默认展示20个。当前支持以下两种优先级的引用链展开方式：

- Retained Size：按照Retained Size从大到小展示周边节点。
- Distance：按照Distance从小到大展示周边节点。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.32812969453534606674831098945823:50001231000000:2800:C2E434E073479AE9F908AC44672BF4097AE2F33DFF9F6260557C9C3E8D19D3A3.png "点击放大")

设置完搜索模式后点击OK，底部页签会自动跳转至Graph页面展示搜索结果，红色标示的是中心节点，线段展示连接的两个节点之间的引用关系。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.74284826303299221868923062307268:50001231000000:2800:0F0C4DDB47B3BF363D3227EED3D531C3BC958193BC51C9E30A349F2614B8821C.png "点击放大")

支持选中节点，右侧的More区域将展示该节点的详细信息，包括Fields、References和Shortest Paths三个页签。当鼠标悬浮在图形上的节点或线段时，悬浮框将展示对应的详细信息。图形区域支持拖动查看，使用Ctrl+鼠标滚轮可对图形进行缩放。

当在节点点击右键，展示的菜单列表包括以下选项：

- **Show More References**：展示当前节点更多的引用链。配置搜索模式后，重新生成以该节点为中心的引用链图形。
- **Show Path to GC Root**：展示当前节点到GC Root的路径。选择搜索模式后，重新生成以该节点为中心到GC Root的引用链图形。
- **Redraw with this node**：以该节点为中心重绘。
- **Reveal in Statistics**：在Statistics页面中显示该节点。
- **Clear Diagram**：清空当前图表中的所有内容。且清空底部栏的激活状态。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.54994918518559370344471380989631:50001231000000:2800:D092C75D0A30D50CA392572E20556D771E1FC0392A125CF4F39D9D125673A457.png "点击放大")

点击**Show More References**、**Show Path to GC Root**和**Redraw with this node**选项后，单击详情区域左下角的左右箭头，可以前进或者后退至下一个或上一个历史图形，以便在多个（最多三个）可视化图形之间跳转查看。当箭头为激活状态时，表示可用，当箭头为灰色状态时则代表无法使用该功能。![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.16327237555245820677767510567464:50001231000000:2800:2CCFF2567515E4A4F27642593972A0C24A1681F92773D31586EA5EB6ED973466.png "点击放大")

## 离线导入内存快照

DevEco Profiler支持离线导入内存快照功能，可导入一个或多个.heapsnapshot及.rawheap文件。

您可以在DevEco Profiler主界面的“Create Session”区域中，单击“Open File”，导入.heapsnapshot或.rawheap文件。

说明

- 导入的单个文件大小不超过1.5G。
- 批量导入的文件数量不超过10个。
- .rawheap文件是应用发生Out of Memory现象时产生的原始内存文件。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.98472484575126311109008060231947:50001231000000:2800:7D1C380D44376EAB57A2C9592C8B0738877857393D209996AB1C1DEEB7CAE53A.png "点击放大")

离线导入内存快照成功后，可以导入与.heapsnapshot或.rawheap文件匹配的.jsleaklist文件，展示jsleakwatcher监控采集到的内存泄漏对象。

说明

- 导入的单个jsleaklist文件大小不超过30M。
- 导入的jsleaklist文件通过文件中的hash值与已导入的heapsnapshot文件匹配。
- 可多次导入不同的jsleaklist文件，也可同时导入多个不同的jsleaklist文件，重复导入不会覆盖已导入的匹配上的jsleaklist文件。总的导入匹配成功的文件数量不超过导入的heapsnapshot文件。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251216155936.44929863554928590017021069791554:50001231000000:2800:5B3C79203BC265520CF38BA2FAEC3F33D56A078B0A5E3BA0E5EBDC9265571925.png "点击放大")

[  
](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-snapshot "ArkTS内存泄漏分析：Snapshot分析")
